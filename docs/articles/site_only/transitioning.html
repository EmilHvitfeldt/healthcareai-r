<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Transitioning from healthcareai v1 to v2 • healthcareai</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/yeti/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../../bootstrap-toc.css">
<script src="../../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../../pkgdown.css" rel="stylesheet">
<script src="../../pkgdown.js"></script><!-- docsearch --><script src="../../docsearch.js"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.3/docsearch.min.css" integrity="sha256-QOSRU/ra9ActyXkIBbiIB144aDBdtvXBcNc3OTNuX/Q=" crossorigin="anonymous">
<link href="../../docsearch.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script><meta property="og:title" content="Transitioning from healthcareai v1 to v2">
<meta property="og:description" content="healthcareai">
<meta property="og:image" content="https://docs.healthcare.ai/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-85609357-1"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-85609357-1');
</script>
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../../index.html">healthcareai</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">2.5.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Vignettes
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../../articles/site_only/healthcareai.html">Getting Started</a>
    </li>
    <li>
      <a href="../../articles/site_only/db_connections.html">Database Connections</a>
    </li>
    <li>
      <a href="../../articles/site_only/deploy_model.html">Deploying a Model</a>
    </li>
    <li>
      <a href="../../articles/site_only/best_levels.html">Variables with Many Categories</a>
    </li>
    <li>
      <a href="../../articles/site_only/performance.html">Performance with Big Data</a>
    </li>
    <li>
      <a href="../../articles/site_only/transitioning.html">Transition from Version 1</a>
    </li>
  </ul>
</li>
<li>
  <a href="../../reference/index.html">Functions</a>
</li>
<li>
  <a href="../../news/index.html">News</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/HealthCatalyst/healthcareai-r">
    <span class="fa fa-github"></span>
     
  </a>
</li>
<li>
  <a href="https://healthcare-ai.slack.com/">
    <span class="fa fa-users"></span>
     
  </a>
</li>
      </ul>
<form class="navbar-form navbar-right hidden-xs hidden-sm" role="search">
        <div class="form-group">
          <input type="search" class="form-control" name="search-input" id="search-input" placeholder="Search..." aria-label="Search for..." autocomplete="off">
</div>
      </form>
      
    </div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Transitioning from healthcareai v1 to v2</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/HealthCatalyst/healthcareai-r/blob/master/vignettes/site_only/transitioning.Rmd"><code>vignettes/site_only/transitioning.Rmd</code></a></small>
      <div class="hidden name"><code>transitioning.Rmd</code></div>

    </div>

    
    
<p>This vignette demonstrates how to translate <code>healthcareai</code> v1 code into v2 code by translating the example from the old <code>RandomForestDeployment</code> help page. Throughout this vignette, commented code is the v1 code that is being updated in each chunk.</p>
<div id="install-and-load-the-package" class="section level2">
<h2 class="hasAnchor">
<a href="#install-and-load-the-package" class="anchor"></a>Install and load the package</h2>
<p>First, check the package version with <code><a href="https://rdrr.io/r/utils/packageDescription.html">packageVersion("healthcareai")</a></code>. If the first digit isn’t 2, you need to update. You should be able to install v2 by running <code><a href="https://rdrr.io/r/utils/install.packages.html">install.packages("healthcareai")</a></code>.</p>
<p>Then, load the package.</p>
<div class="sourceCode" id="cb1"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">healthcareai</span>)
<span class="co"># &gt; healthcareai version 2.5.0</span>
<span class="co"># &gt; Please visit https://docs.healthcare.ai for full documentation and vignettes. Join the community at https://healthcare-ai.slack.com</span></pre></body></html></div>
</div>
<div id="load-data" class="section level2">
<h2 class="hasAnchor">
<a href="#load-data" class="anchor"></a>Load Data</h2>
<p>First, we’ll read the data from the repository and inspect it.</p>
<div class="sourceCode" id="cb2"><html><body><pre class="r"><span class="co"># csvfile &lt;- system.file("extdata", </span>
<span class="co">#                        "HCRDiabetesClinical.csv", </span>
<span class="co">#                        package = "healthcareai")</span>
<span class="co"># df &lt;- read.csv(file = csvfile, </span>
<span class="co">#                header = TRUE, </span>
<span class="co">#                na.strings = c("NULL", "NA", ""))</span>
<span class="co"># </span>
<span class="co"># df$PatientID &lt;- NULL # Only one ID column (ie, PatientEncounterID) is needed remove this column</span>
<span class="co">## v2 lets you retain any number of identifier columns</span>

<span class="no">df</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span>(<span class="st">"https://raw.githubusercontent.com/HealthCatalyst/healthcareai-r/8355ee33a6ea2ad549c8f840832b7843ddf27b04/inst/extdata/HCRDiabetesClinical.csv"</span>,
               <span class="kw">na.strings</span> <span class="kw">=</span> <span class="st">""</span>)
<span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span>(<span class="no">df</span>)
<span class="co"># &gt; 'data.frame':   1000 obs. of  7 variables:</span>
<span class="co"># &gt;  $ PatientEncounterID : int  1 2 3 4 5 6 7 8 9 10 ...</span>
<span class="co"># &gt;  $ PatientID          : int  10001 10001 10001 10002 10002 10002 10002 10003 10003 10003 ...</span>
<span class="co"># &gt;  $ SystolicBPNBR      : int  167 153 170 187 188 185 189 149 155 160 ...</span>
<span class="co"># &gt;  $ LDLNBR             : int  195 214 191 135 125 178 101 160 144 130 ...</span>
<span class="co"># &gt;  $ A1CNBR             : num  4.2 5 4 4.4 4.3 5 4 5 6.6 8 ...</span>
<span class="co"># &gt;  $ GenderFLG          : chr  "M" "M" "M" "M" ...</span>
<span class="co"># &gt;  $ ThirtyDayReadmitFLG: chr  "N" "N" "N" "N" ...</span></pre></body></html></div>
<p>There are missing values in the outcome variable <code>ThirtyDayReadmitFLG</code>, and v2 of the package intentionally does not allow missing values in the outcome, so we will discard those rows. Missingness in predictors is automatically taken care of and a variety of imputation methods <a href="https://docs.healthcare.ai/reference/index.html#section-data-preparation">are supported</a>.</p>
<div class="sourceCode" id="cb3"><html><body><pre class="r"><span class="no">df</span> <span class="kw">&lt;-</span> <span class="kw pkg">dplyr</span><span class="kw ns">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(<span class="no">df</span>, !<span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span>(<span class="no">ThirtyDayReadmitFLG</span>))</pre></body></html></div>
</div>
<div id="reserve-validation-set" class="section level2">
<h2 class="hasAnchor">
<a href="#reserve-validation-set" class="anchor"></a>Reserve Validation Set</h2>
<p>This is an optional step. Withholding some data from model training and evaluating model performance on that data provides a rigorously honest estimation of how well the model will perform on new data. <code>healthcareai</code> v2 actually does this repeatedly under the hood in model training (through cross validation), so the performance reported on training data should be consistent with performance on new data; however, validation on a test dataset can still be useful, so we demonstrate how to do it here.</p>
<p><code>split_train_test</code> returns two data frames, <code>train</code> and <code>test</code>, ensuring equal representation of the outcome in each. The following code puts 95% of rows in <code>train</code> and 5% of rows in <code>test</code>. The latter won’t be used in model training, and instead will be used to make predictions to see how well the model performs on data it has never seen.</p>
<div class="sourceCode" id="cb4"><html><body><pre class="r"><span class="co"># dfDeploy &lt;- df[951:1000,]</span>
<span class="no">d</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../../reference/split_train_test.html">split_train_test</a></span>(<span class="no">df</span>, <span class="kw">outcome</span> <span class="kw">=</span> <span class="no">ThirtyDayReadmitFLG</span>, <span class="kw">percent_train</span> <span class="kw">=</span> <span class="fl">.95</span>)</pre></body></html></div>
</div>
<div id="train-models" class="section level2">
<h2 class="hasAnchor">
<a href="#train-models" class="anchor"></a>Train Models</h2>
<p><code>machine_learn</code> needs the name of the data frame, any columns that shouldn’t be used in training (identifier columns), and the outcome variable. It will do everything else automatically, including imputing missing values, training multiple algorithms, optimizing algorithm details through cross validation, and much more. Specifying <code>models = "rf"</code> means that only random forests will be trained; if left blank, all supported models will be trained, and the best performing model will be used to make predictions.</p>
<div class="sourceCode" id="cb5"><html><body><pre class="r"><span class="co"># p &lt;- SupervisedModelDevelopmentParams$new()</span>
<span class="co"># p$df &lt;- df</span>
<span class="co"># p$type &lt;- "classification"</span>
<span class="co"># p$impute &lt;- TRUE</span>
<span class="co"># p$grainCol &lt;- "PatientEncounterID"</span>
<span class="co"># p$predictedCol &lt;- "ThirtyDayReadmitFLG"</span>
<span class="co"># p$debug &lt;- FALSE</span>
<span class="co"># p$cores &lt;- 1</span>
<span class="co"># </span>
<span class="co"># # Run RandomForest</span>
<span class="co"># RandomForest &lt;- RandomForestDevelopment$new(p)</span>
<span class="co"># RandomForest$run()</span>

<span class="no">models</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../../reference/machine_learn.html">machine_learn</a></span>(<span class="no">d</span>$<span class="no">train</span>,
                        <span class="no">PatientEncounterID</span>, <span class="no">PatientID</span>,
                        <span class="kw">outcome</span> <span class="kw">=</span> <span class="no">ThirtyDayReadmitFLG</span>,
                        <span class="kw">models</span> <span class="kw">=</span> <span class="st">"rf"</span>)
<span class="co"># &gt; Training new data prep recipe...</span>
<span class="co"># &gt; Variable(s) ignored in prep_data won't be used to tune models: PatientEncounterID and PatientID</span>
<span class="co"># &gt; </span>
<span class="co"># &gt; ThirtyDayReadmitFLG looks categorical, so training classification algorithms.</span>
<span class="co"># &gt; </span>
<span class="co"># &gt; After data processing, models are being trained on 6 features with 942 observations.</span>
<span class="co"># &gt; Based on n_folds = 5 and hyperparameter settings, the following number of models will be trained: 50 rf's</span>
<span class="co"># &gt; Training with cross validation: Random Forest</span>
<span class="co"># &gt; </span>
<span class="co"># &gt; *** Models successfully trained. The model object contains the training data minus ignored ID columns. ***</span>
<span class="co"># &gt; *** If there was PHI in training data, normal PHI protocols apply to the model object. ***</span></pre></body></html></div>
</div>
<div id="save-and-load-models" class="section level2">
<h2 class="hasAnchor">
<a href="#save-and-load-models" class="anchor"></a>Save and Load Models</h2>
<p><code>healthcareai</code> v1 automatically saved models in the working directory, and automatically loaded them from the working directory. v2 instead provides functions to make it easy to save and load models. This is only necrequires you to manage model files if you want to use the models in a different R session than the one in which you trained the models.</p>
<p>As with other objects in R, you can save an object to disk like this:</p>
<div class="sourceCode" id="cb6"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/save.html">save</a></span>(<span class="no">models</span>, <span class="kw">file</span> <span class="kw">=</span> <span class="st">"my_random_forests.RDA"</span>)</pre></body></html></div>
<p>That will write the <code>models</code> object to the <code>my_random_forests.RDA</code> file in the working directory. You can find out where that is by running <code><a href="https://rdrr.io/r/base/getwd.html">getwd()</a></code>.</p>
<p>Loading the models with the following line will reestablish the <code>models</code> object in a new R session. That means you can move the <code>my_random_forests.RDA</code> file to another directory or another computer, and get your models there with this line. If the RDA file is in a different directory than your R script (or project if you use RStudio’s Projects), you’ll need to point to that location relative to the current working directory, e.g. <code><a href="https://rdrr.io/r/base/load.html">load("../data/trained_models/my_random_forests.RDA")</a></code>. Here is some <a href="http://stat545.com/block002_hello-r-workspace-wd-project.html#working-directory">recommended reading</a> on working directories and filepaths if you need help loading saved models.</p>
<div class="sourceCode" id="cb7"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/load.html">load</a></span>(<span class="st">"my_random_forests.RDA"</span>)</pre></body></html></div>
</div>
<div id="make-predictions" class="section level2">
<h2 class="hasAnchor">
<a href="#make-predictions" class="anchor"></a>Make Predictions</h2>
<p>To make predictions on the training dataset, simply pass the model object to <code>predict</code>. To make predictions on new data, pass the data frame to <code>predict</code> after the model object.</p>
<div class="sourceCode" id="cb8"><html><body><pre class="r"><span class="co"># p2 &lt;- SupervisedModelDeploymentParams$new()</span>
<span class="co"># p2$type &lt;- "classification"</span>
<span class="co"># p2$df &lt;- dfDeploy</span>
<span class="co"># p2$grainCol &lt;- "PatientEncounterID"</span>
<span class="co"># p2$predictedCol &lt;- "ThirtyDayReadmitFLG"</span>
<span class="co"># p2$impute &lt;- TRUE</span>
<span class="co"># p2$debug &lt;- FALSE</span>
<span class="co"># p2$cores &lt;- 1</span>
<span class="co"># </span>
<span class="co"># dL &lt;- RandomForestDeployment$new(p2)</span>
<span class="co"># dL$deploy()</span>
<span class="co"># </span>
<span class="co"># dfOut &lt;- dL$getOutDf()</span>
<span class="co"># head(dfOut)</span>

<span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span>(<span class="no">models</span>, <span class="no">d</span>$<span class="no">test</span>)
<span class="co"># &gt; Prepping data based on provided recipe</span>
<span class="co"># &gt; "predicted_ThirtyDayReadmitFLG" predicted by Random Forest last trained: 2020-08-05 09:20:40</span>
<span class="co"># &gt; Performance in training: AUROC = 0.87</span>
<span class="co"># &gt; # A tibble: 48 x 8</span>
<span class="co"># &gt;   ThirtyDayReadmi… predicted_Thirt… PatientEncounte… PatientID SystolicBPNBR</span>
<span class="co"># &gt; * &lt;fct&gt;                       &lt;dbl&gt;            &lt;int&gt;     &lt;int&gt;         &lt;int&gt;</span>
<span class="co"># &gt; 1 N                         0.103                 16     10004           117</span>
<span class="co"># &gt; 2 Y                         0.807                 19     10004           187</span>
<span class="co"># &gt; 3 N                         0.00580               29     10005           170</span>
<span class="co"># &gt; 4 N                         0.0516                46     10008           134</span>
<span class="co"># &gt; 5 Y                         0.254                 56     10009           191</span>
<span class="co"># &gt; # … with 43 more rows, and 3 more variables: LDLNBR &lt;int&gt;, A1CNBR &lt;dbl&gt;,</span>
<span class="co"># &gt; #   GenderFLG &lt;chr&gt;</span></pre></body></html></div>
</div>
<div id="further-reading" class="section level2">
<h2 class="hasAnchor">
<a href="#further-reading" class="anchor"></a>Further Reading</h2>
<p>For more detail on using v2 or about what’s happening under the hood, see <a href="https://docs.healthcare.ai/articles/site_only/healthcareai.html">Getting Started</a> or the <a href="https://docs.healthcare.ai/reference/index.html">function reference page</a>. To see how to connect to a database, see <a href="https://docs.healthcare.ai/articles/site_only/db_connections.html">Database Connections</a>.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Levi Thatcher, Michael Levy, Mike Mastanduno, Taylor Larsen, Taylor Miller, Rex Sumsion.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  
<script src="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.1/docsearch.min.js" integrity="sha256-GKvGqXDznoRYHCwKXGnuchvKSwmx9SRMrZOTh2g4Sb0=" crossorigin="anonymous"></script><script>
  docsearch({
    
    
    apiKey: 'ac39465bc37cbef616f5de1e646b6037',
    indexName: 'healthcareai',
    inputSelector: 'input#search-input.form-control',
    transformData: function(hits) {
      return hits.map(function (hit) {
        hit.url = updateHitURL(hit);
        return hit;
      });
    }
  });
</script>
</body>
</html>
