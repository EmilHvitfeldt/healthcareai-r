<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Get predictions — predict.model_list • healthcareai</title>

<!-- favicons -->
<link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png" />
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png" />
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png" />
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png" />

<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/yeti/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous" />


<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>


<!-- docsearch -->
<script src="../docsearch.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.3/docsearch.min.css" integrity="sha256-QOSRU/ra9ActyXkIBbiIB144aDBdtvXBcNc3OTNuX/Q=" crossorigin="anonymous" />
<link href="../docsearch.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script>



<meta property="og:title" content="Get predictions — predict.model_list" />
<meta property="og:description" content="Make predictions using the best-performing model. For
  classification models, predicted probabilities are always returned, and you
  can get either predicted outcome class by specifying outcome_groups
  or risk groups by specifying risk_groups." />
<meta property="og:image" content="https://docs.healthcare.ai/logo.png" />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->


<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-85609357-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-85609357-1');
</script>


  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">healthcareai</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">2.5.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Vignettes
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/site_only/healthcareai.html">Getting Started</a>
    </li>
    <li>
      <a href="../articles/site_only/db_connections.html">Database Connections</a>
    </li>
    <li>
      <a href="../articles/site_only/deploy_model.html">Deploying a Model</a>
    </li>
    <li>
      <a href="../articles/site_only/best_levels.html">Variables with Many Categories</a>
    </li>
    <li>
      <a href="../articles/site_only/performance.html">Performance with Big Data</a>
    </li>
    <li>
      <a href="../articles/site_only/transitioning.html">Transition from Version 1</a>
    </li>
  </ul>
</li>
<li>
  <a href="../reference/index.html">Functions</a>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/HealthCatalyst/healthcareai-r">
    <span class="fa fa-github"></span>
     
  </a>
</li>
<li>
  <a href="https://healthcare-ai.slack.com/">
    <span class="fa fa-users"></span>
     
  </a>
</li>
      </ul>
      
      <form class="navbar-form navbar-right hidden-xs hidden-sm" role="search">
        <div class="form-group">
          <input type="search" class="form-control" name="search-input" id="search-input" placeholder="Search..." aria-label="Search for..." autocomplete="off">
        </div>
      </form>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Get predictions</h1>
    <small class="dont-index">Source: <a href='https://github.com/HealthCatalyst/healthcareai-r/blob/master/R/predict.R'><code>R/predict.R</code></a></small>
    <div class="hidden name"><code>predict.model_list.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Make predictions using the best-performing model. For
  classification models, predicted probabilities are always returned, and you
  can get either predicted outcome class by specifying <code>outcome_groups</code>
  or risk groups by specifying <code>risk_groups</code>.</p>
    </div>

    <pre class="usage"><span class='co'># S3 method for model_list</span>
<span class='fu'><a href='https://rdrr.io/r/stats/predict.html'>predict</a></span>(
  <span class='no'>object</span>,
  <span class='no'>newdata</span>,
  <span class='kw'>risk_groups</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>outcome_groups</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='no'>prepdata</span>,
  <span class='kw'>write_log</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>,
  <span class='no'>...</span>
)</pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>object</th>
      <td><p>model_list object, as from `tune_models`</p></td>
    </tr>
    <tr>
      <th>newdata</th>
      <td><p>data on which to make predictions. If missing, out-of-fold
predictions from training will be returned If you want new predictions on
training data using the final model, pass the training data to this
argument, but know that you're getting over-fit predictions that very
likely overestimate model performance relative to what will be achieved on
new data. Should have the same structure as the input to
`prep_data`,`tune_models` or `train_models`. `predict` will try to figure
out if the data need to be sent through `prep_data` before making
predictions; this can be overridden by setting `prepdata = FALSE`, but this
should rarely be needed.</p></td>
    </tr>
    <tr>
      <th>risk_groups</th>
      <td><p>Should predictions be grouped into risk groups and
returned in column "predicted_group"? If this is NULL (default), they will
not be. If this is a single number, that number of groups will be created
with names "risk_group1", "risk_group2", etc. "risk_group1" is always the
highest risk (highest predicted probability). The groups will have equal
expected sizes, based on the distribution of out-of-fold predictions on the
training data. If this is a character vector, its entries will be used as
the names of the risk groups, in increasing order of risk, again with equal
expected sizes of groups. If you want unequal-size groups, this can be a
named numeric vector, where the names will be the names of the risk groups,
in increasing order of risk, and the entries will be the relative
proportion of observations in the group, again based on the distribution of
out-of-fold predictions on the training data. For example,
<code>risk_groups = c(low = 2, mid = 1, high = 1)</code> will put the bottom half
of predicted probabilities in the "low" group, the next quarter in the
"mid" group, and the highest quarter in the "high" group. You can get the
cutoff values used to separate groups by passing the output of
<code>predict</code> to <code><a href='get_cutoffs.html'>get_cutoffs</a></code>. Note that only one of
<code>risk_groups</code> and <code>outcome_groups</code> can be specified.</p></td>
    </tr>
    <tr>
      <th>outcome_groups</th>
      <td><p>Should predictions be grouped into outcome classes and
returned in column "predicted_group"? If this is NULL (default), they will
not be. The threshold for splitting outcome classes is determined on the
training data via <code><a href='get_thresholds.html'>get_thresholds</a></code>. If this is TRUE, the
threshold is chosen to maximize accuracy, i.e. false positives and false
negatives are equally weighted. If this is a number it is the ratio of cost
(badnesss) of false negatives (missed detections) to false positives (false
alarms). For example, <code>outcome_groups = 5</code> indicates a preferred ratio
of five false alarms to every missed detection, and <code>outcome_groups =
.5</code> indicates that two missed detections is as bad as one false alarm. This
value is passed to the <code>cost_fn</code> argument of
<code><a href='get_thresholds.html'>get_thresholds</a></code>. You can get the cutoff values used to
separate groups by passing the output of <code>predict</code> to
<code><a href='get_cutoffs.html'>get_cutoffs</a></code>. Note that only one of <code>risk_groups</code> and
<code>outcome_groups</code> can be specified.</p></td>
    </tr>
    <tr>
      <th>prepdata</th>
      <td><p>Defunct. Data are always prepped in prediction.</p></td>
    </tr>
    <tr>
      <th>write_log</th>
      <td><p>Write prediction metadata to a file? Default is FALSE. If
TRUE, will create or append a file called "prediction_log.txt" in the
current directory with metadata about predictions. If a character, is the
name of a file to create or append with prediction metadata. If you want a
unique log file each time predictions are made, use something like
<code>write_log = paste0(Sys.time(), " predictions.txt")</code>. This param
modifies error behavior and is best used in production. See details.</p></td>
    </tr>
    <tr>
      <th>...</th>
      <td><p>Unused.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>A tibble data frame: newdata with an additional column for the
  predictions in "predicted_TARGET" where TARGET is the name of the variable
  being predicted. If classification, the new column will contain predicted
  probabilities. The tibble will have child class "predicted_df" and
  attribute "model_info" that contains information about the model used to
  make predictions. You can call <code>plot</code> or <code>evaluate</code> on a
  predicted_df. If <code>write_log</code> is TRUE and this function errors, a
  zero-row dataframe will be returned.</p>
<p>Returned data will contain an attribute, "prediction_log" that contains a
  tibble of  logging info for writing to database. If <code>write_log</code> is
  TRUE and predict errors, an empty dataframe with the "prediction_log"
  attribute will still be returned. Extract this attribute using
  <code><a href='https://rdrr.io/r/base/attr.html'>attr(pred, "prediction_log")</a></code>.</p>
<p>Data will also contain a "failed" attribute to easily filter for errors
  after prediction. Extract using <code><a href='https://rdrr.io/r/base/attr.html'>attr(pred, "failed")</a></code>.</p>
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>The model and hyperparameter values with the best out-of-fold
  performance in model training according to the selected metric is used to
  make predictions. Prepping data inside `predict` has the advantage of
  returning your predictions with the newdata in its original format.</p>
<p>If <code>write_log</code> is TRUE and an error is encountered, <code>predict</code>
  will not stop. It will return the error message as: - A warning in the
  console - A field in the log file - A column in the "prediction_log"
  attribute - A zero-row data frame will be returned</p>
    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <div class='dont-index'><p><code><a href='plot.predicted_df.html'>plot.predicted_df</a></code>,
  <code><a href='evaluate.html'>evaluate.predicted_df</a></code>, <code><a href='get_thresholds.html'>get_thresholds</a></code>,
  <code><a href='get_cutoffs.html'>get_cutoffs</a></code></p></div>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='co'>### Data prep and model training ###</span>
<span class='co'>####################################</span>

<span class='fu'><a href='https://rdrr.io/r/base/Random.html'>set.seed</a></span>(<span class='fl'>7510</span>)
<span class='co'># Split the first 200 rows in pima_diabetes into a model-training dataset</span>
<span class='co'># containing 3/4 of the data and a test dataset containing 1/4 of the data.</span>
<span class='no'>d</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='split_train_test.html'>split_train_test</a></span>(<span class='no'>pima_diabetes</span>[<span class='fl'>1</span>:<span class='fl'>200</span>, ], <span class='no'>diabetes</span>, <span class='fl'>.75</span>)

<span class='co'># Prep the training data for model training and train regularized regression</span>
<span class='co'># and extreme gradient boosted models</span>
<span class='no'>models</span> <span class='kw'>&lt;-</span>
  <span class='no'>d</span>$<span class='no'>train</span> <span class='kw'>%&gt;%</span>
  <span class='fu'><a href='prep_data.html'>prep_data</a></span>(<span class='no'>patient_id</span>, <span class='kw'>outcome</span> <span class='kw'>=</span> <span class='no'>diabetes</span>) <span class='kw'>%&gt;%</span>
  <span class='fu'><a href='flash_models.html'>flash_models</a></span>(<span class='kw'>outcome</span> <span class='kw'>=</span> <span class='no'>diabetes</span>, <span class='kw'>models</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='st'>"glm"</span>, <span class='st'>"xgb"</span>))</div><div class='output co'>#&gt; <span class='message'>Training new data prep recipe...</span></div><div class='output co'>#&gt; <span class='message'>Variable(s) ignored in prep_data won't be used to tune models: patient_id</span></div><div class='output co'>#&gt; <span class='message'></span>
#&gt; <span class='message'>diabetes looks categorical, so training classification algorithms.</span></div><div class='output co'>#&gt; <span class='message'></span>
#&gt; <span class='message'>After data processing, models are being trained on 12 features with 151 observations.</span>
#&gt; <span class='message'>Based on n_folds = 5 and hyperparameter settings, the following number of models will be trained: 50 glm's and 5 xgb's </span></div><div class='output co'>#&gt; <span class='message'>Training at fixed values: glmnet</span></div><div class='output co'>#&gt; <span class='message'>Training at fixed values: eXtreme Gradient Boosting</span></div><div class='output co'>#&gt; <span class='message'></span>
#&gt; <span class='message'>*** Models successfully trained. The model object contains the training data minus ignored ID columns. ***</span>
#&gt; <span class='message'>*** If there was PHI in training data, normal PHI protocols apply to the model object. ***</span></div><div class='input'>
<span class='co'>### Making predictions ###</span>
<span class='co'>##########################</span>

<span class='co'># Make prediction on test data using the model that performed best in</span>
<span class='co'># cross validation during model training. Before predictions are made, the test</span>
<span class='co'># data is automatically prepared the same way the training data was.</span>
<span class='no'>predictions</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/predict.html'>predict</a></span>(<span class='no'>models</span>, <span class='kw'>newdata</span> <span class='kw'>=</span> <span class='no'>d</span>$<span class='no'>test</span>)</div><div class='output co'>#&gt; <span class='message'>Prepping data based on provided recipe</span></div><div class='input'><span class='no'>predictions</span></div><div class='output co'>#&gt; <span class='message'>"predicted_diabetes" predicted by glmnet last trained: 2020-08-05 09:08:42</span>
#&gt; <span class='message'>Performance in training: AUROC = 0.84</span></div><div class='output co'>#&gt; <span style='color: #555555;'># A tibble: 49 x 11</span><span>
#&gt;    diabetes predicted_diabe… patient_id pregnancies plasma_glucose diastolic_bp
#&gt;  </span><span style='color: #555555;'>*</span><span> </span><span style='color: #555555;font-style: italic;'>&lt;fct&gt;</span><span>               </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span>      </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span>       </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span>          </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span>        </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span>
#&gt; </span><span style='color: #555555;'> 1</span><span> N                  0.340          11           4            110           92
#&gt; </span><span style='color: #555555;'> 2</span><span> Y                  0.946          23           7            196           90
#&gt; </span><span style='color: #555555;'> 3</span><span> Y                  0.752          25          11            143           94
#&gt; </span><span style='color: #555555;'> 4</span><span> N                  0.058</span><span style='text-decoration: underline;'>7</span><span>         28           1             97           66
#&gt; </span><span style='color: #555555;'> 5</span><span> Y                  0.559          40           4            111           72
#&gt; </span><span style='color: #555555;'> 6</span><span> N                  0.853          41           3            180           64
#&gt; </span><span style='color: #555555;'> 7</span><span> N                  0.675          42           7            133           84
#&gt; </span><span style='color: #555555;'> 8</span><span> Y                  0.941          46           0            180           66
#&gt; </span><span style='color: #555555;'> 9</span><span> N                  0.066</span><span style='text-decoration: underline;'>0</span><span>         52           1            101           50
#&gt; </span><span style='color: #555555;'>10</span><span> N                  0.815          59           0            146           82
#&gt; </span><span style='color: #555555;'># … with 39 more rows, and 5 more variables: skinfold </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span style='color: #555555;'>, insulin </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span style='color: #555555;'>,</span><span>
#&gt; </span><span style='color: #555555;'>#   weight_class </span><span style='color: #555555;font-style: italic;'>&lt;chr&gt;</span><span style='color: #555555;'>, pedigree </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span style='color: #555555;'>, age </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span></div><div class='input'><span class='fu'><a href='evaluate.html'>evaluate</a></span>(<span class='no'>predictions</span>)</div><div class='output co'>#&gt;      AUPR     AUROC 
#&gt; 0.5902730 0.7365591 </div><div class='input'><span class='fu'><a href='https://rdrr.io/r/base/plot.html'>plot</a></span>(<span class='no'>predictions</span>)</div><div class='img'><img src='predict.model_list-1.png' alt='' width='576' height='288' /></div><div class='input'>
<span class='co'>### Outcome class predictions ###</span>
<span class='co'>#################################</span>

<span class='co'># If you want class predictions in addition to predicted probabilities for</span>
<span class='co'># a classification model, specify outcome_groups. The number passed to</span>
<span class='co'># outcome groups is the cost of a false negative relative to a false positive.</span>
<span class='co'># This example specifies that one missed detection is as bad as ten false</span>
<span class='co'># alarms, and the resulting confusion matrix reflects this preference.</span>
<span class='no'>class_preds</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/predict.html'>predict</a></span>(<span class='no'>models</span>, <span class='kw'>newdata</span> <span class='kw'>=</span> <span class='no'>d</span>$<span class='no'>test</span>, <span class='kw'>outcome_groups</span> <span class='kw'>=</span> <span class='fl'>10</span>)</div><div class='output co'>#&gt; <span class='message'>Prepping data based on provided recipe</span></div><div class='input'><span class='fu'><a href='https://rdrr.io/r/base/table.html'>table</a></span>(<span class='kw'>actual</span> <span class='kw'>=</span> <span class='no'>class_preds</span>$<span class='no'>diabetes</span>, <span class='kw'>predicted</span> <span class='kw'>=</span> <span class='no'>class_preds</span>$<span class='no'>predicted_group</span>)</div><div class='output co'>#&gt;       predicted
#&gt; actual  N  Y
#&gt;      Y  0 18
#&gt;      N  7 24</div><div class='input'>
<span class='co'># You can extract the threshold used to separate predicted Y from predicted N</span>
<span class='fu'><a href='get_cutoffs.html'>get_cutoffs</a></span>(<span class='no'>class_preds</span>)</div><div class='output co'>#&gt; <span class='message'>Predicted outcomes N and Y separated at: 0.0792</span></div><div class='input'>
<span class='co'># And you can visualize that cutoff by simply plotting the predictions</span>
<span class='fu'><a href='https://rdrr.io/r/base/plot.html'>plot</a></span>(<span class='no'>class_preds</span>)</div><div class='img'><img src='predict.model_list-2.png' alt='' width='576' height='288' /></div><div class='input'>
<span class='co'>### Risk stratification ###</span>
<span class='co'>###########################</span>

<span class='co'># Alternatively, you can stratify observations into risk groups by specifying</span>
<span class='co'># the risk_groups parameter. For example, this creates five risk groups</span>
<span class='co'># with custom names. Risk group assignment is based on the distribution of</span>
<span class='co'># predicted probabilities in model training. This is useful because it preserves</span>
<span class='co'># a consistent notion of risk; for example, if you make daily predictions and</span>
<span class='co'># one day happens to contain only low-risk patients, those patients will all</span>
<span class='co'># be classified as low risk. Over the long run, group sizes will be consistent,</span>
<span class='co'># but in any given round of predictions they may differ. If you want fixed</span>
<span class='co'># group sizes, see the following examples.</span>
<span class='fu'><a href='https://rdrr.io/r/stats/predict.html'>predict</a></span>(<span class='no'>models</span>, <span class='no'>d</span>$<span class='no'>test</span>,
        <span class='kw'>risk_groups</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='st'>"very low"</span>, <span class='st'>"low"</span>, <span class='st'>"medium"</span>, <span class='st'>"high"</span>, <span class='st'>"very high"</span>)) <span class='kw'>%&gt;%</span>
  <span class='fu'><a href='https://rdrr.io/r/base/plot.html'>plot</a></span>()</div><div class='output co'>#&gt; <span class='message'>Prepping data based on provided recipe</span></div><div class='img'><img src='predict.model_list-3.png' alt='' width='576' height='288' /></div><div class='input'>
<span class='co'>### Fixed size groups ###</span>
<span class='co'>#########################</span>

<span class='co'># If you want groups of fixed sizes, e.g. say you have capacity to admit the three</span>
<span class='co'># highest-risk patients, treat the next five, and have to discharge the remainder,</span>
<span class='co'># you can use predicted probabilities to do that. One way to do that is to</span>
<span class='co'># arrange the predictions data frame in descending order of risk, and then use the</span>
<span class='co'># row numbers to stratify patients</span>
<span class='fu'><a href='https://rdrr.io/r/base/library.html'>library</a></span>(<span class='no'>dplyr</span>)
<span class='fu'><a href='https://rdrr.io/r/stats/predict.html'>predict</a></span>(<span class='no'>models</span>, <span class='no'>d</span>$<span class='no'>test</span>) <span class='kw'>%&gt;%</span>
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/arrange.html'>arrange</a></span>(<span class='fu'><a href='https://dplyr.tidyverse.org/reference/desc.html'>desc</a></span>(<span class='no'>predicted_diabetes</span>)) <span class='kw'>%&gt;%</span>
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span>(<span class='kw'>action</span> <span class='kw'>=</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/case_when.html'>case_when</a></span>(
    <span class='fu'><a href='https://dplyr.tidyverse.org/reference/ranking.html'>row_number</a></span>() <span class='kw'>&lt;=</span> <span class='fl'>3</span> ~ <span class='st'>"admit"</span>,
    <span class='fu'><a href='https://dplyr.tidyverse.org/reference/ranking.html'>row_number</a></span>() <span class='kw'>&lt;=</span> <span class='fl'>8</span> ~ <span class='st'>"treat"</span>,
    <span class='fl'>TRUE</span> ~ <span class='st'>"discharge"</span>
  )) <span class='kw'>%&gt;%</span>
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/select.html'>select</a></span>(<span class='no'>predicted_diabetes</span>, <span class='no'>action</span>, <span class='fu'><a href='https://dplyr.tidyverse.org/reference/reexports.html'>everything</a></span>())</div><div class='output co'>#&gt; <span class='message'>Prepping data based on provided recipe</span></div><div class='output co'>#&gt; <span class='message'>"predicted_diabetes" predicted by glmnet last trained: 2020-08-05 09:08:42</span>
#&gt; <span class='message'>Performance in training: AUROC = 0.84</span></div><div class='output co'>#&gt; </span><span style='color: #555555;'># A tibble: 49 x 12</span><span>
#&gt;    predicted_diabe… action diabetes patient_id pregnancies plasma_glucose
#&gt;  </span><span style='color: #555555;'>*</span><span>            </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span> </span><span style='color: #555555;font-style: italic;'>&lt;chr&gt;</span><span>  </span><span style='color: #555555;font-style: italic;'>&lt;fct&gt;</span><span>         </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span>       </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span>          </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span>
#&gt; </span><span style='color: #555555;'> 1</span><span>            0.946 admit  Y                23           7            196
#&gt; </span><span style='color: #555555;'> 2</span><span>            0.941 admit  Y                46           0            180
#&gt; </span><span style='color: #555555;'> 3</span><span>            0.920 admit  Y               187           8            181
#&gt; </span><span style='color: #555555;'> 4</span><span>            0.853 treat  N                41           3            180
#&gt; </span><span style='color: #555555;'> 5</span><span>            0.815 treat  N                59           0            146
#&gt; </span><span style='color: #555555;'> 6</span><span>            0.801 treat  Y               121           0            162
#&gt; </span><span style='color: #555555;'> 7</span><span>            0.800 treat  Y               112           8            155
#&gt; </span><span style='color: #555555;'> 8</span><span>            0.788 treat  Y               196           5            158
#&gt; </span><span style='color: #555555;'> 9</span><span>            0.752 disch… Y                25          11            143
#&gt; </span><span style='color: #555555;'>10</span><span>            0.711 disch… Y               116           4            146
#&gt; </span><span style='color: #555555;'># … with 39 more rows, and 6 more variables: diastolic_bp </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span style='color: #555555;'>,</span><span>
#&gt; </span><span style='color: #555555;'>#   skinfold </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span style='color: #555555;'>, insulin </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span style='color: #555555;'>, weight_class </span><span style='color: #555555;font-style: italic;'>&lt;chr&gt;</span><span style='color: #555555;'>, pedigree </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span style='color: #555555;'>,</span><span>
#&gt; </span><span style='color: #555555;'>#   age </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span></div><div class='input'>
<span class='co'># Finally, if you want a fixed group size that is further down on the risk</span>
<span class='co'># scale, you can achieve that with a combination of risk groups and the</span>
<span class='co'># stratifying approach in the last example. For example, say you have capacity</span>
<span class='co'># to admit 5 patients, but you don't want to admit patients in the top 10% of</span>
<span class='co'># risk scores.</span>
<span class='fu'><a href='https://rdrr.io/r/stats/predict.html'>predict</a></span>(<span class='no'>models</span>, <span class='no'>d</span>$<span class='no'>test</span>,
        <span class='kw'>risk_groups</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='st'>"risk acceptable"</span> <span class='kw'>=</span> <span class='fl'>90</span>, <span class='st'>"risk too high"</span> <span class='kw'>=</span> <span class='fl'>10</span>)) <span class='kw'>%&gt;%</span>
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span>(<span class='no'>predicted_group</span> <span class='kw'>==</span> <span class='st'>"risk acceptable"</span>) <span class='kw'>%&gt;%</span>
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/top_n.html'>top_n</a></span>(<span class='kw'>n</span> <span class='kw'>=</span> <span class='fl'>5</span>, <span class='kw'>wt</span> <span class='kw'>=</span> <span class='no'>predicted_diabetes</span>)</div><div class='output co'>#&gt; <span class='message'>Prepping data based on provided recipe</span></div><div class='output co'>#&gt; <span class='message'>"predicted_diabetes" predicted by glmnet last trained: 2020-08-05 09:08:42</span>
#&gt; <span class='message'>Performance in training: AUROC = 0.84</span></div><div class='output co'>#&gt; </span><span style='color: #555555;'># A tibble: 5 x 12</span><span>
#&gt;   diabetes predicted_diabe… predicted_group patient_id pregnancies
#&gt; </span><span style='color: #555555;'>*</span><span> </span><span style='color: #555555;font-style: italic;'>&lt;fct&gt;</span><span>               </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span> </span><span style='color: #555555;font-style: italic;'>&lt;fct&gt;</span><span>                </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span>       </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span>
#&gt; </span><span style='color: #555555;'>1</span><span> Y                   0.752 risk acceptable         25          11
#&gt; </span><span style='color: #555555;'>2</span><span> N                   0.815 risk acceptable         59           0
#&gt; </span><span style='color: #555555;'>3</span><span> Y                   0.800 risk acceptable        112           8
#&gt; </span><span style='color: #555555;'>4</span><span> Y                   0.801 risk acceptable        121           0
#&gt; </span><span style='color: #555555;'>5</span><span> Y                   0.788 risk acceptable        196           5
#&gt; </span><span style='color: #555555;'># … with 7 more variables: plasma_glucose </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span style='color: #555555;'>, diastolic_bp </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span style='color: #555555;'>,</span><span>
#&gt; </span><span style='color: #555555;'>#   skinfold </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span style='color: #555555;'>, insulin </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span style='color: #555555;'>, weight_class </span><span style='color: #555555;font-style: italic;'>&lt;chr&gt;</span><span style='color: #555555;'>, pedigree </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span style='color: #555555;'>,</span><span>
#&gt; </span><span style='color: #555555;'>#   age </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span></div></span></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Levi Thatcher, Michael Levy, Mike Mastanduno, Taylor Larsen, Taylor Miller, Rex Sumsion.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
   </div>

  
<script src="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.1/docsearch.min.js" integrity="sha256-GKvGqXDznoRYHCwKXGnuchvKSwmx9SRMrZOTh2g4Sb0=" crossorigin="anonymous"></script>
<script>
  docsearch({
    
    
    apiKey: 'ac39465bc37cbef616f5de1e646b6037',
    indexName: 'healthcareai',
    inputSelector: 'input#search-input.form-control',
    transformData: function(hits) {
      return hits.map(function (hit) {
        hit.url = updateHitURL(hit);
        return hit;
      });
    }
  });
</script>



  </body>
</html>


