<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Build efficient features from high-cardinality, multiple-membership
factors — add_best_levels • healthcareai</title>

<!-- favicons -->
<link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png" />
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png" />
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png" />
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png" />

<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
<!-- Bootstrap -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/yeti/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous" />


<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/all.min.css" integrity="sha256-nAmazAk6vS34Xqo0BSrTb+abbtFlgsFK7NKSi6o7Y78=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/v4-shims.min.css" integrity="sha256-6qHlizsOWFskGlwVOKuns+D1nB6ssZrHQrNj1wGplHc=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>


<!-- docsearch -->
<script src="../docsearch.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.1/docsearch.min.css" integrity="sha256-QOSRU/ra9ActyXkIBbiIB144aDBdtvXBcNc3OTNuX/Q=" crossorigin="anonymous" />
<link href="../docsearch.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script>



<meta property="og:title" content="Build efficient features from high-cardinality, multiple-membership
factors — add_best_levels" />
<meta property="og:description" content="In healthcare, we are often faced with high cardinality
  variables, where each observation may have zero, one, or more levels, e.g.
  medications for a model at the patient grain. In these cases, creating a
  feature variable for each level (each medication) as in one-hot encoding
  can be prohibitively computationally intensive and can hurt performance by
  diminishing the signal-to-noise ratio. get_best_levels identifies a
  subset of categories that are likely to be valuable features, and
  add_best_levels adds them to a model data frame.
get_best_levels finds levels of groups that are likely to be
  useful predictors in d and returns them as a character vector.
  add_best_levels does the same and adds them, pivoted, to d.
  The function attempts to find both positive and negative predictors of
  outcome.
add_best_levels stores the identified best levels and passes them
  through model training so that in deployment, the same columns created in
  training are again created (see the final example).
add_best_levels accepts arguments to pivot so that
  values associated with the levels (e.g. doses of medications) can be used
  in the new features. However, note that these are not used in determining
  the best levels. I.e. get_best_levels determines which levels are
  likely to be good predictors looking only at outcomes where the levels are
  present or abssent; it does not use fill or fun in this
  determination. See details for more info about how levels are
  selected." />
<meta property="og:image" content="https://docs.healthcare.ai/logo.png" />
<meta name="twitter:card" content="summary" />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->


<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-85609357-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-85609357-1');
</script>


  </head>

  <body>
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">healthcareai</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">2.4.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Vignettes
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/site_only/healthcareai.html">Getting Started</a>
    </li>
    <li>
      <a href="../articles/site_only/db_connections.html">Database Connections</a>
    </li>
    <li>
      <a href="../articles/site_only/deploy_model.html">Deploying a Model</a>
    </li>
    <li>
      <a href="../articles/site_only/best_levels.html">Variables with Many Categories</a>
    </li>
    <li>
      <a href="../articles/site_only/performance.html">Performance with Big Data</a>
    </li>
    <li>
      <a href="../articles/site_only/transitioning.html">Transition from Version 1</a>
    </li>
  </ul>
</li>
<li>
  <a href="../reference/index.html">Functions</a>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/HealthCatalyst/healthcareai-r">
    <span class="fa fa-github"></span>
     
  </a>
</li>
<li>
  <a href="https://healthcare-ai.slack.com/">
    <span class="fa fa-users"></span>
     
  </a>
</li>
      </ul>
      
      <form class="navbar-form navbar-right hidden-xs hidden-sm" role="search">
        <div class="form-group">
          <input type="search" class="form-control" name="search-input" id="search-input" placeholder="Search..." aria-label="Search for..." autocomplete="off">
        </div>
      </form>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Build efficient features from high-cardinality, multiple-membership
factors</h1>
    
    <div class="hidden name"><code>add_best_levels.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>In healthcare, we are often faced with high cardinality
  variables, where each observation may have zero, one, or more levels, e.g.
  medications for a model at the patient grain. In these cases, creating a
  feature variable for each level (each medication) as in one-hot encoding
  can be prohibitively computationally intensive and can hurt performance by
  diminishing the signal-to-noise ratio. <code>get_best_levels</code> identifies a
  subset of categories that are likely to be valuable features, and
  <code>add_best_levels</code> adds them to a model data frame.</p>
<p><code>get_best_levels</code> finds levels of <code>groups</code> that are likely to be
  useful predictors in <code>d</code> and returns them as a character vector.
  <code>add_best_levels</code> does the same and adds them, pivoted, to <code>d</code>.
  The function attempts to find both positive and negative predictors of
  <code>outcome</code>.</p>
<p><code>add_best_levels</code> stores the identified best levels and passes them
  through model training so that in deployment, the same columns created in
  training are again created (see the final example).</p>
<p><code>add_best_levels</code> accepts arguments to <code><a href='pivot.html'>pivot</a></code> so that
  values associated with the levels (e.g. doses of medications) can be used
  in the new features. However, note that these are not used in determining
  the best levels. I.e. <code>get_best_levels</code> determines which levels are
  likely to be good predictors looking only at outcomes where the levels are
  present or abssent; it does not use <code>fill</code> or <code>fun</code> in this
  determination. See <code>details</code> for more info about how levels are
  selected.</p>
    </div>

    <pre class="usage"><span class='fu'>add_best_levels</span>(
  <span class='no'>d</span>,
  <span class='no'>longsheet</span>,
  <span class='no'>id</span>,
  <span class='no'>groups</span>,
  <span class='no'>outcome</span>,
  <span class='kw'>n_levels</span> <span class='kw'>=</span> <span class='fl'>100</span>,
  <span class='kw'>min_obs</span> <span class='kw'>=</span> <span class='fl'>1</span>,
  <span class='kw'>positive_class</span> <span class='kw'>=</span> <span class='st'>"Y"</span>,
  <span class='kw'>cohesion_weight</span> <span class='kw'>=</span> <span class='fl'>2</span>,
  <span class='kw'>levels</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='no'>fill</span>,
  <span class='kw'>fun</span> <span class='kw'>=</span> <span class='no'>sum</span>,
  <span class='kw'>missing_fill</span> <span class='kw'>=</span> <span class='fl'>NA</span>
)

<span class='fu'>get_best_levels</span>(
  <span class='no'>d</span>,
  <span class='no'>longsheet</span>,
  <span class='no'>id</span>,
  <span class='no'>groups</span>,
  <span class='no'>outcome</span>,
  <span class='kw'>n_levels</span> <span class='kw'>=</span> <span class='fl'>100</span>,
  <span class='kw'>min_obs</span> <span class='kw'>=</span> <span class='fl'>1</span>,
  <span class='kw'>positive_class</span> <span class='kw'>=</span> <span class='st'>"Y"</span>,
  <span class='kw'>cohesion_weight</span> <span class='kw'>=</span> <span class='fl'>2</span>
)</pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>d</th>
      <td><p>Data frame to use in models, at desired grain. Has id and outcome</p></td>
    </tr>
    <tr>
      <th>longsheet</th>
      <td><p>Data frame containing multiple observations per grain. Has
id and groups</p></td>
    </tr>
    <tr>
      <th>id</th>
      <td><p>Name of identifier column, unquoted. Must be present and identical
in both tables</p></td>
    </tr>
    <tr>
      <th>groups</th>
      <td><p>Name of grouping column, unquoted</p></td>
    </tr>
    <tr>
      <th>outcome</th>
      <td><p>Name of outcome column, unquoted</p></td>
    </tr>
    <tr>
      <th>n_levels</th>
      <td><p>Number of levels to return, default = 100. An attempt is made
to return half levels positively associated with the outcome and half
negatively. If n_levels is greater than the number present, all levels will
be returned</p></td>
    </tr>
    <tr>
      <th>min_obs</th>
      <td><p>Minimum number of observations a level must be found in in
order to be considered. Defaults to one, but larger values are often useful
because a level present in only a few observation will rarely be a useful.</p></td>
    </tr>
    <tr>
      <th>positive_class</th>
      <td><p>If classification model, the positive class of the
outcome, default = "Y"; ignored if regression</p></td>
    </tr>
    <tr>
      <th>cohesion_weight</th>
      <td><p>For classification problems only, how much to value a
level being consistently associated with an outcome relative to its being
present in many observations. Default = 2; equal weight is 1. Note that
this is a parameter that could potentially be tuned over.</p></td>
    </tr>
    <tr>
      <th>levels</th>
      <td><p>Use this argument when add_best_levels was used in training and
you want to add the same columns for deployment. You can pass the model
trained on the data frame from <code>add_best_levels</code>, the data frame from
<code>add_best_levels</code>, or a character vector of levels to add.</p></td>
    </tr>
    <tr>
      <th>fill</th>
      <td><p>Passed to <code><a href='pivot.html'>pivot</a></code>. Column to be used to fill the
values of cells in the output, perhaps after aggregation by <code>fun</code>. If
<code>fill</code> is not provided, counts will be used, as though a fill column
of 1s had been provided.</p></td>
    </tr>
    <tr>
      <th>fun</th>
      <td><p>Passed to <code><a href='pivot.html'>pivot</a></code>. Function for aggregation, defaults
to <code>sum</code>. Custom functions can be used with the same syntax as the
apply family of functions, e.g. <code>fun = function(x)
some_function(another_fun(x))</code>.</p></td>
    </tr>
    <tr>
      <th>missing_fill</th>
      <td><p>Passed to <code><a href='pivot.html'>pivot</a></code>. Value to fill for
combinations of grain and spread that are not present. Defaults to NA, but
0 may be useful as well.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>For <code>add_best_levels</code>, d with new columns for the best levels
  added and best_levels attribute containing a named list of levels added.
  For <code>get_best_levels</code>, a character vector of the best levels.</p>
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>Here is how <code>get_best_levels</code> determines the levels of
  <code>groups</code> that are likely to be good predictors.</p>
<p></p><ul>
<li><p>For regression: For each group, the difference of the group-mean from the
  grand-mean is divided by the standard deviation of the group as a sample
  (i.e. centered_mean(group) / sqrt(var(group) / n(group))), and the groups
  with the largest absolute values of that statistic are retained.</p></li>
<li><p>For classification: For each group, two "log-loss-like" statistics are
  calculated. One is the log of the fraction of observations in which the
  group does not appear, which captures how ubiquitous the group is: more
  common groups are more useful as predictors. The other captures how far the
  group is from being always associated with the same outcome: groups that
  are consistently assoicated with either outcome are more useful as
  predictors. This is calculated as the log of the proportion of outcomes
  that are not all the same outcome (e.g. if 4/5 observations are positive
  class, this statistic is log(.2)). This value is then raised to the
  <code>cohesion_weight</code> power. To ensure retainment of both positive- and
  negative-predictors, the all-same-outcome that is used as the comparison is
  determined by which side of the median proportion of positive_class the
  group falls on.</p></li>
</ul>

    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <div class='dont-index'><p><code><a href='pivot.html'>pivot</a></code></p></div>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='fu'><a href='https://rdrr.io/r/base/Random.html'>set.seed</a></span>(<span class='fl'>45796</span>)

<span class='co'># We have two tables we want to use in our models:</span>
<span class='co'># - df is the model table. It has the outcomes (survived), and we want one</span>
<span class='co'>#   prediction for each row in df</span>
<span class='co'># - meds has detailed information on each row (patient) in df. Each patient</span>
<span class='co'>#   may have zero, one, or more observations (drugs) in meds, and meds may</span>
<span class='co'>#   have associated values (doses).</span>

<span class='no'>df</span> <span class='kw'>&lt;-</span> <span class='kw pkg'>tibble</span><span class='kw ns'>::</span><span class='fu'><a href='https://tibble.tidyverse.org/reference/tibble.html'>tibble</a></span>(
  <span class='kw'>patient</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste0</a></span>(<span class='st'>"Z"</span>, <span class='fu'><a href='https://rdrr.io/r/base/sample.html'>sample</a></span>(<span class='fl'>10</span>, <span class='fl'>5</span>)),
  <span class='kw'>age</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/sample.html'>sample</a></span>(<span class='fl'>20</span>:<span class='fl'>80</span>, <span class='fl'>5</span>),
  <span class='kw'>survived</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/sample.html'>sample</a></span>(<span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='st'>"N"</span>, <span class='st'>"Y"</span>), <span class='fl'>5</span>, <span class='kw'>replace</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>, <span class='kw'>prob</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='fl'>1</span>, <span class='fl'>2</span>))
)

<span class='no'>meds</span> <span class='kw'>&lt;-</span> <span class='kw pkg'>tibble</span><span class='kw ns'>::</span><span class='fu'><a href='https://tibble.tidyverse.org/reference/tibble.html'>tibble</a></span>(
  <span class='kw'>patient</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/sample.html'>sample</a></span>(<span class='no'>df</span>$<span class='no'>patient</span>, <span class='fl'>10</span>, <span class='kw'>replace</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>),
  <span class='kw'>drug</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/sample.html'>sample</a></span>(<span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='st'>"Quinapril"</span>, <span class='st'>"Vancomycin"</span>, <span class='st'>"Ibuprofen"</span>,
                  <span class='st'>"Paclitaxel"</span>, <span class='st'>"Epinephrine"</span>, <span class='st'>"Dexamethasone"</span>),
                <span class='fl'>10</span>, <span class='kw'>replace</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>),
  <span class='kw'>dose</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/sample.html'>sample</a></span>(<span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='fl'>100</span>, <span class='fl'>250</span>), <span class='fl'>10</span>, <span class='kw'>replace</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>)
)

<span class='co'># Identify three drugs likely to be good predictors of survival</span>

<span class='fu'>get_best_levels</span>(<span class='kw'>d</span> <span class='kw'>=</span> <span class='no'>df</span>,
                <span class='kw'>longsheet</span> <span class='kw'>=</span> <span class='no'>meds</span>,
                <span class='kw'>id</span> <span class='kw'>=</span> <span class='no'>patient</span>,
                <span class='kw'>groups</span> <span class='kw'>=</span> <span class='no'>drug</span>,
                <span class='kw'>outcome</span> <span class='kw'>=</span> <span class='no'>survived</span>,
                <span class='kw'>n_levels</span> <span class='kw'>=</span> <span class='fl'>3</span>)</div><div class='output co'>#&gt; [1] "Epinephrine" "Ibuprofen"   "Paclitaxel" </div><div class='input'>
<span class='co'># Identify four drugs likely to make good features and add them to df.</span>
<span class='co'># The "fill", "fun", and "missing_fill" arguments are passed to</span>
<span class='co'># `pivot`, which allows us to use the total doses of each drug given to the</span>
<span class='co'># patient as our new features</span>

<span class='no'>new_df</span> <span class='kw'>&lt;-</span> <span class='fu'>add_best_levels</span>(<span class='kw'>d</span> <span class='kw'>=</span> <span class='no'>df</span>,
                          <span class='kw'>longsheet</span> <span class='kw'>=</span> <span class='no'>meds</span>,
                          <span class='kw'>id</span> <span class='kw'>=</span> <span class='no'>patient</span>,
                          <span class='kw'>groups</span> <span class='kw'>=</span> <span class='no'>drug</span>,
                          <span class='kw'>outcome</span> <span class='kw'>=</span> <span class='no'>survived</span>,
                          <span class='kw'>n_levels</span> <span class='kw'>=</span> <span class='fl'>4</span>,
                          <span class='kw'>fill</span> <span class='kw'>=</span> <span class='no'>dose</span>,
                          <span class='kw'>fun</span> <span class='kw'>=</span> <span class='no'>sum</span>,
                          <span class='kw'>missing_fill</span> <span class='kw'>=</span> <span class='fl'>0</span>)
<span class='no'>new_df</span></div><div class='output co'>#&gt; <span style='color: #555555;'># A tibble: 5 x 7</span><span>
#&gt;   patient   age survived drug_Dexamethas… drug_Epinephrine drug_Ibuprofen
#&gt;   </span><span style='color: #555555;font-style: italic;'>&lt;chr&gt;</span><span>   </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span> </span><span style='color: #555555;font-style: italic;'>&lt;chr&gt;</span><span>               </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span>            </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span>          </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span>
#&gt; </span><span style='color: #555555;'>1</span><span> Z10        23 N                       0                0              0
#&gt; </span><span style='color: #555555;'>2</span><span> Z2         20 N                     350              100              0
#&gt; </span><span style='color: #555555;'>3</span><span> Z6         59 Y                       0                0            100
#&gt; </span><span style='color: #555555;'>4</span><span> Z7         52 Y                     250                0            100
#&gt; </span><span style='color: #555555;'>5</span><span> Z8         53 N                       0                0              0
#&gt; </span><span style='color: #555555;'># … with 1 more variable: drug_Paclitaxel </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span></div><div class='input'>
<span class='co'># The names of the medications that were added to df in new_df are stored in the</span>
<span class='co'># best_levels attribute of new_df so that the same columns can be added in</span>
<span class='co'># deployment. This is useful because you need to have the same columns to make</span>
<span class='co'># predictions as you had in model training. When you are ready to add levels to</span>
<span class='co'># a deployment data frame, you can pass to the "levels" argument of</span>
<span class='co'># add_best_levels either the models trained on new_df, new_df itself, or the</span>
<span class='co'># character vector of levels to add.</span>

<span class='no'>deployment_df</span> <span class='kw'>&lt;-</span> <span class='kw pkg'>tibble</span><span class='kw ns'>::</span><span class='fu'><a href='https://tibble.tidyverse.org/reference/tibble.html'>tibble</a></span>(
  <span class='kw'>patient</span> <span class='kw'>=</span> <span class='st'>"p6"</span>,
  <span class='kw'>age</span> <span class='kw'>=</span> <span class='fl'>30</span>
)
<span class='no'>deployment_meds</span> <span class='kw'>&lt;-</span> <span class='kw pkg'>tibble</span><span class='kw ns'>::</span><span class='fu'><a href='https://tibble.tidyverse.org/reference/tibble.html'>tibble</a></span>(
  <span class='kw'>patient</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/rep.html'>rep</a></span>(<span class='st'>"p6"</span>, <span class='fl'>2</span>),
  <span class='kw'>drug</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/rep.html'>rep</a></span>(<span class='st'>"Vancomycin"</span>, <span class='fl'>2</span>),
  <span class='kw'>dose</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='fl'>100</span>, <span class='fl'>250</span>)
)

<span class='co'># Now, even though Vancomycin is the only drug that appears in</span>
<span class='co'># deployment_meds, because we pass new_df to "levels", we get all the columns</span>
<span class='co'># needed to make predictions on a model trained on new_df</span>

<span class='fu'>add_best_levels</span>(<span class='kw'>d</span> <span class='kw'>=</span> <span class='no'>deployment_df</span>,
                <span class='kw'>longsheet</span> <span class='kw'>=</span> <span class='no'>deployment_meds</span>,
                <span class='kw'>id</span> <span class='kw'>=</span> <span class='no'>patient</span>,
                <span class='kw'>groups</span> <span class='kw'>=</span> <span class='no'>drug</span>,
                <span class='kw'>levels</span> <span class='kw'>=</span> <span class='no'>new_df</span>,
                <span class='kw'>fill</span> <span class='kw'>=</span> <span class='no'>dose</span>,
                <span class='kw'>missing_fill</span> <span class='kw'>=</span> <span class='fl'>0</span>)</div><div class='output co'>#&gt; </span><span style='color: #555555;'># A tibble: 1 x 6</span><span>
#&gt;   patient   age drug_Epinephrine drug_Ibuprofen drug_Paclitaxel drug_Dexamethas…
#&gt;   </span><span style='color: #555555;font-style: italic;'>&lt;chr&gt;</span><span>   </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span>            </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span>          </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span>           </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span>            </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span>
#&gt; </span><span style='color: #555555;'>1</span><span> p6         30                0              0               0                0</div></span></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <h2>Contents</h2>
    <ul class="nav nav-pills nav-stacked">
      <li><a href="#arguments">Arguments</a></li>
      <li><a href="#value">Value</a></li>
      <li><a href="#details">Details</a></li>
      <li><a href="#see-also">See also</a></li>
      <li><a href="#examples">Examples</a></li>
    </ul>

  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Levi Thatcher, Michael Levy, Mike Mastanduno, Taylor Larsen, Taylor Miller, Rex Sumsion.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.4.1.</p>
</div>

      </footer>
   </div>

  
<script src="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.1/docsearch.min.js" integrity="sha256-GKvGqXDznoRYHCwKXGnuchvKSwmx9SRMrZOTh2g4Sb0=" crossorigin="anonymous"></script>
<script>
  docsearch({
    
    
    apiKey: 'ac39465bc37cbef616f5de1e646b6037',
    indexName: 'healthcareai',
    inputSelector: 'input#search-input.form-control',
    transformData: function(hits) {
      return hits.map(function (hit) {
        hit.url = updateHitURL(hit);
        return hit;
      });
    }
  });
</script>



  </body>
</html>


