<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Pivot multiple rows per observation to one row with multiple columns — pivot • healthcareai</title>

<!-- jquery -->
<script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script>
<!-- Bootstrap -->
<link href="https://maxcdn.bootstrapcdn.com/bootswatch/3.3.7/yeti/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">

<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

<!-- Font Awesome icons -->
<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js" integrity="sha384-cV+rhyOuRHc9Ub/91rihWcGmMmCXDeksTtCihMupQHSsi8GIIRDG0ThDc3HGQFJ3" crossorigin="anonymous"></script>

<!-- sticky kit -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>


<!-- docsearch -->
<script src="../docsearch.js"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.css" />
<link href="../docsearch.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script>


<meta property="og:title" content="Pivot multiple rows per observation to one row with multiple columns — pivot" />

<meta property="og:description" content="Pivot multiple rows per observation to one row with multiple columns" />

<meta property="og:image" content="https://docs.healthcare.ai/logo.png" />
<meta name="twitter:card" content="summary" />



<!-- mathjax -->
<script src='https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML'></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->


<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-85609357-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-85609357-1');
</script>

  </head>

  <body>
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">healthcareai</a>
        <span class="label label-default" data-toggle="tooltip" data-placement="bottom" title="Released package">2.1.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Vignettes
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/site_only/healthcareai.html">Getting Started</a>
    </li>
    <li>
      <a href="../articles/site_only/db_connections.html">Database Connections</a>
    </li>
    <li>
      <a href="../articles/site_only/deploy_model.html">Deploying a Model</a>
    </li>
    <li>
      <a href="../articles/site_only/best_levels.html">Variables with Many Categories</a>
    </li>
    <li>
      <a href="../articles/site_only/performance.html">Performance with Big Data</a>
    </li>
    <li>
      <a href="../articles/site_only/transitioning.html">Transition from Version 1</a>
    </li>
  </ul>
</li>
<li>
  <a href="../reference/index.html">Functions</a>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
      </ul>
      
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/HealthCatalyst/healthcareai-r">
    <span class="fa fa-github"></span>
     
  </a>
</li>
<li>
  <a href="https://healthcare-ai.slack.com/">
    <span class="fa fa-users"></span>
     
  </a>
</li>
      </ul>
      
      <form class="navbar-form navbar-right" role="search">
        <div class="form-group">
          <input type="search" class="form-control" name="search-input" id="search-input" placeholder="Search..." aria-label="Search for..." autocomplete="off">
        </div>
      </form>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      
      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Pivot multiple rows per observation to one row with multiple columns</h1>
    
    <div class="hidden name"><code>pivot.Rd</code></div>
    </div>

    <div class="ref-description">
    
    <p>Pivot multiple rows per observation to one row with multiple columns</p>
    
    </div>

    <pre class="usage"><span class='fu'>pivot</span>(<span class='no'>d</span>, <span class='no'>grain</span>, <span class='no'>spread</span>, <span class='no'>fill</span>, <span class='kw'>fun</span> <span class='kw'>=</span> <span class='no'>sum</span>, <span class='kw'>missing_fill</span> <span class='kw'>=</span> <span class='fl'>NA</span>, <span class='no'>extra_cols</span>)</pre>
    
    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>d</th>
      <td><p>data frame</p></td>
    </tr>
    <tr>
      <th>grain</th>
      <td><p>Column that defines rows. Unquoted.</p></td>
    </tr>
    <tr>
      <th>spread</th>
      <td><p>Column that will become multiple columns. Unquoted.</p></td>
    </tr>
    <tr>
      <th>fill</th>
      <td><p>Column to be used to fill the values of cells in the output,
perhaps after aggregation by <code>fun</code>. If <code>fill</code> is not provided,
counts will be used, as though a fill column of 1s had been provided.</p></td>
    </tr>
    <tr>
      <th>fun</th>
      <td><p>Function for aggregation, defaults to <code>sum</code>. Custom functions
can be used with the same syntax as the apply family of functions, e.g.
<code>fun = function(x) some_function(another_fun(x))</code>.</p></td>
    </tr>
    <tr>
      <th>missing_fill</th>
      <td><p>Value to fill for combinations of grain and spread that
are not present. Defaults to NA, but 0 may be useful as well.</p></td>
    </tr>
    <tr>
      <th>extra_cols</th>
      <td><p>Values of <code>spread</code> to create all-<code>missing_fill</code>
columns, for e.g. if you want to add levels that were observed in training
but are not present in deployment.</p></td>
    </tr>
    </table>
    
    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>A tibble data frame with one row for each unique value of
  <code>grain</code>, and one column for each unique value of <code>spread</code> plus
  one column for the entries in grain.</p>
<p>Entries in the tibble are defined by the fill column. Combinations of
  <code>grain</code> x <code>spread</code> that are not present in <code>d</code> will be
  filled in with <code>missing_fill</code>. If there are <code>grain</code> x
  <code>spread</code> pairs that appear more than once in d, they will be
  aggregated by <code>fun</code>.</p>
    
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p><code>pivot</code> is useful when you want to change the grain of your
  data, for example from the procedure grain to the patient grain. In that
  example, each patient might have 0, 1, or more medications. To make a
  patient-level table, we need a column for each medication, which is what it
  means to make a wide table. The <code>fill</code> argument dictates what to put
  in each of the medication columns, e.g. the dose the patient got.
  <code>fill</code> defaults to "1", as an indicator variable. If any patients have
  multiple rows for the same medication (say they recieved a med more than
  once), we need a way to deal with that, which is what the <code>fun</code>
  argument handles. By default it uses <code>sum</code>, so if <code>fill</code> is left
  as its default, the count of instances for each patient will be used.</p>
    

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='no'>meds</span> <span class='kw'>&lt;-</span>
  <span class='kw pkg'>tibble</span><span class='kw ns'>::</span><span class='fu'><a href='http://www.rdocumentation.org/packages/tibble/topics/tibble'>tibble</a></span>(
    <span class='kw'>patient_id</span> <span class='kw'>=</span> <span class='fu'>c</span>(<span class='st'>"A"</span>, <span class='st'>"A"</span>, <span class='st'>"A"</span>, <span class='st'>"B"</span>),
    <span class='kw'>medication</span> <span class='kw'>=</span> <span class='fu'>c</span>(<span class='st'>"zoloft"</span>, <span class='st'>"asprin"</span>, <span class='st'>"lipitor"</span>, <span class='st'>"asprin"</span>),
    <span class='kw'>pills_per_day</span> <span class='kw'>=</span> <span class='fu'>c</span>(<span class='fl'>1</span>, <span class='fl'>8</span>, <span class='fl'>2</span>, <span class='fl'>4</span>)
  )
<span class='no'>meds</span></div><div class='output co'>#&gt; # A tibble: 4 x 3
#&gt;   patient_id medication pills_per_day
#&gt;   &lt;chr&gt;      &lt;chr&gt;              &lt;dbl&gt;
#&gt; 1 A          zoloft                 1
#&gt; 2 A          asprin                 8
#&gt; 3 A          lipitor                2
#&gt; 4 B          asprin                 4</div><div class='input'>
<span class='co'># Number of pills of each medication each patient gets:</span>
<span class='fu'>pivot</span>(
  <span class='kw'>d</span> <span class='kw'>=</span> <span class='no'>meds</span>,
  <span class='kw'>grain</span> <span class='kw'>=</span> <span class='no'>patient_id</span>,
  <span class='kw'>spread</span> <span class='kw'>=</span> <span class='no'>medication</span>,
  <span class='kw'>fill</span> <span class='kw'>=</span> <span class='no'>pills_per_day</span>,
  <span class='kw'>missing_fill</span> <span class='kw'>=</span> <span class='fl'>0</span>
)</div><div class='output co'>#&gt; # A tibble: 2 x 4
#&gt;   patient_id medication_asprin medication_lipitor medication_zoloft
#&gt;   &lt;chr&gt;                  &lt;dbl&gt;              &lt;dbl&gt;             &lt;dbl&gt;
#&gt; 1 A                          8                  2                 1
#&gt; 2 B                          4                  0                 0</div><div class='input'>
<span class='no'>bills</span> <span class='kw'>&lt;-</span>
  <span class='kw pkg'>tibble</span><span class='kw ns'>::</span><span class='fu'><a href='http://www.rdocumentation.org/packages/tibble/topics/tibble'>tibble</a></span>(
    <span class='kw'>patient_id</span> <span class='kw'>=</span> <span class='fu'>rep</span>(<span class='fu'>c</span>(<span class='st'>"A"</span>, <span class='st'>"B"</span>), <span class='kw'>each</span> <span class='kw'>=</span> <span class='fl'>4</span>),
    <span class='kw'>dept_id</span> <span class='kw'>=</span> <span class='fu'>rep</span>(<span class='fu'>c</span>(<span class='st'>"ED"</span>, <span class='st'>"ICU"</span>), <span class='kw'>times</span> <span class='kw'>=</span> <span class='fl'>4</span>),
    <span class='kw'>charge</span> <span class='kw'>=</span> <span class='fu'>runif</span>(<span class='fl'>8</span>, <span class='fl'>0</span>, <span class='fl'>1e4</span>),
    <span class='kw'>date</span> <span class='kw'>=</span> <span class='fu'>as.Date</span>(<span class='st'>"2024-12-25"</span>) - <span class='fu'>sample</span>(<span class='fl'>0</span>:<span class='fl'>2</span>, <span class='fl'>8</span>, <span class='fl'>TRUE</span>)
  )
<span class='no'>bills</span></div><div class='output co'>#&gt; # A tibble: 8 x 4
#&gt;   patient_id dept_id charge date      
#&gt;   &lt;chr&gt;      &lt;chr&gt;    &lt;dbl&gt; &lt;date&gt;    
#&gt; 1 A          ED        495. 2024-12-25
#&gt; 2 A          ICU      1762. 2024-12-24
#&gt; 3 A          ED       7828. 2024-12-24
#&gt; 4 A          ICU      2800. 2024-12-25
#&gt; 5 B          ED       2031. 2024-12-23
#&gt; 6 B          ICU      3884. 2024-12-25
#&gt; 7 B          ED       9263. 2024-12-24
#&gt; 8 B          ICU      5197. 2024-12-23</div><div class='input'>
<span class='co'># Total charges per patient x department:</span>
<span class='fu'>pivot</span>(<span class='no'>bills</span>, <span class='no'>patient_id</span>, <span class='no'>dept_id</span>, <span class='no'>charge</span>, <span class='no'>sum</span>)</div><div class='output co'>#&gt; # A tibble: 2 x 3
#&gt;   patient_id dept_id_ED dept_id_ICU
#&gt;   &lt;chr&gt;           &lt;dbl&gt;       &lt;dbl&gt;
#&gt; 1 A               8323.       4561.
#&gt; 2 B              11294.       9082.</div><div class='input'>
<span class='co'># Count of charges per patient x day:</span>
<span class='fu'>pivot</span>(<span class='no'>bills</span>, <span class='no'>patient_id</span>, <span class='no'>date</span>)</div><div class='output co'>#&gt; <span class='message'>No fill column was provided, so using "1" for present entities</span></div><div class='output co'>#&gt; <span class='message'>There are rows that contain the same values of both patient_id and date but you didn't provide a function to 'fun' for their aggregation. Proceeding with the default: fun = sum.</span></div><div class='output co'>#&gt; # A tibble: 2 x 4
#&gt;   patient_id `date_2024-12-23` `date_2024-12-24` `date_2024-12-25`
#&gt;   &lt;chr&gt;                  &lt;int&gt;             &lt;int&gt;             &lt;int&gt;
#&gt; 1 A                         NA                 2                 2
#&gt; 2 B                          2                 1                 1</div><div class='input'>
<span class='co'># Can provide a custom function to fun, which will take fill as input.</span>
<span class='co'># Get the difference between the greatest and smallest charge in each</span>
<span class='co'># department for each patient and format it as currency.</span>
<span class='fu'>pivot</span>(<span class='kw'>d</span> <span class='kw'>=</span> <span class='no'>bills</span>,
      <span class='kw'>grain</span> <span class='kw'>=</span> <span class='no'>patient_id</span>,
      <span class='kw'>spread</span> <span class='kw'>=</span> <span class='no'>dept_id</span>,
      <span class='kw'>fill</span> <span class='kw'>=</span> <span class='no'>charge</span>,
      <span class='kw'>fun</span> <span class='kw'>=</span> <span class='kw'>function</span>(<span class='no'>x</span>) <span class='fu'>paste0</span>(<span class='st'>"$"</span>, <span class='fu'>round</span>(<span class='fu'>max</span>(<span class='no'>x</span>) - <span class='fu'>min</span>(<span class='no'>x</span>), <span class='fl'>2</span>))
)</div><div class='output co'>#&gt; # A tibble: 2 x 3
#&gt;   patient_id dept_id_ED dept_id_ICU
#&gt;   &lt;chr&gt;      &lt;chr&gt;      &lt;chr&gt;      
#&gt; 1 A          $7333.36   $1037.95   
#&gt; 2 B          $7231.55   $1313.01   </div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <h2>Contents</h2>
    <ul class="nav nav-pills nav-stacked">
      <li><a href="#arguments">Arguments</a></li>
      
      <li><a href="#value">Value</a></li>

      <li><a href="#details">Details</a></li>
      
      <li><a href="#examples">Examples</a></li>
    </ul>

  </div>
</div>

      <footer>
      <div class="copyright">
  <p>Developed by Levi Thatcher, Michael Levy, Mike Mastanduno, Taylor Larsen, Taylor Miller.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>

      </footer>
   </div>

  
<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.js"></script>
<script>
  docsearch({
    
    
    apiKey: 'ac39465bc37cbef616f5de1e646b6037',
    indexName: 'healthcareai',
    inputSelector: 'input#search-input.form-control',
    transformData: function(hits) {
      return hits.map(function (hit) {
        hit.url = updateHitURL(hit);
        return hit;
      });
    }
  });
</script>


  </body>
</html>

