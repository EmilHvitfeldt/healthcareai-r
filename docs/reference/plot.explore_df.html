<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Plot Counterfactual Predictions — plot.explore_df • healthcareai</title>

<!-- jquery -->
<script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script>
<!-- Bootstrap -->
<link href="https://maxcdn.bootstrapcdn.com/bootswatch/3.3.7/yeti/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">

<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

<!-- Font Awesome icons -->
<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js" integrity="sha384-cV+rhyOuRHc9Ub/91rihWcGmMmCXDeksTtCihMupQHSsi8GIIRDG0ThDc3HGQFJ3" crossorigin="anonymous"></script>

<!-- sticky kit -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>


<!-- docsearch -->
<script src="../docsearch.js"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.css" />
<link href="../docsearch.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script>


<meta property="og:title" content="Plot Counterfactual Predictions — plot.explore_df" />

<meta property="og:description" content="Plot Counterfactual Predictions" />

<meta property="og:image" content="https://docs.healthcare.ai/logo.png" />
<meta name="twitter:card" content="summary" />



<!-- mathjax -->
<script src='https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML'></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->


<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-85609357-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-85609357-1');
</script>

  </head>

  <body>
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">healthcareai</a>
        <span class="label label-default" data-toggle="tooltip" data-placement="bottom" title="Released package">2.2.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Vignettes
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/site_only/healthcareai.html">Getting Started</a>
    </li>
    <li>
      <a href="../articles/site_only/db_connections.html">Database Connections</a>
    </li>
    <li>
      <a href="../articles/site_only/deploy_model.html">Deploying a Model</a>
    </li>
    <li>
      <a href="../articles/site_only/best_levels.html">Variables with Many Categories</a>
    </li>
    <li>
      <a href="../articles/site_only/performance.html">Performance with Big Data</a>
    </li>
    <li>
      <a href="../articles/site_only/transitioning.html">Transition from Version 1</a>
    </li>
  </ul>
</li>
<li>
  <a href="../reference/index.html">Functions</a>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
      </ul>
      
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/HealthCatalyst/healthcareai-r">
    <span class="fa fa-github"></span>
     
  </a>
</li>
<li>
  <a href="https://healthcare-ai.slack.com/">
    <span class="fa fa-users"></span>
     
  </a>
</li>
      </ul>
      
      <form class="navbar-form navbar-right" role="search">
        <div class="form-group">
          <input type="search" class="form-control" name="search-input" id="search-input" placeholder="Search..." aria-label="Search for..." autocomplete="off">
        </div>
      </form>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      
      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Plot Counterfactual Predictions</h1>
    
    <div class="hidden name"><code>plot.explore_df.Rd</code></div>
    </div>

    <div class="ref-description">
    
    <p>Plot Counterfactual Predictions</p>
    
    </div>

    <pre class="usage"><span class='co'># S3 method for explore_df</span>
<span class='fu'>plot</span>(<span class='no'>x</span>, <span class='kw'>n_use</span> <span class='kw'>=</span> <span class='fl'>2</span>, <span class='kw'>aggregate_fun</span> <span class='kw'>=</span> <span class='no'>median</span>,
  <span class='kw'>reorder_categories</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>, <span class='no'>x_var</span>, <span class='no'>color_var</span>, <span class='kw'>jitter_y</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>,
  <span class='kw'>sig_fig</span> <span class='kw'>=</span> <span class='fl'>3</span>, <span class='kw'>font_size</span> <span class='kw'>=</span> <span class='fl'>11</span>, <span class='kw'>strip_font_size</span> <span class='kw'>=</span> <span class='fl'>0.85</span>, <span class='kw'>line_width</span> <span class='kw'>=</span> <span class='fl'>0.5</span>,
  <span class='kw'>line_alpha</span> <span class='kw'>=</span> <span class='fl'>0.7</span>, <span class='kw'>rotate_x</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>, <span class='kw'>nrows</span> <span class='kw'>=</span> <span class='fl'>1</span>, <span class='kw'>title</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='no'>caption</span>,
  <span class='kw'>print</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>, <span class='no'>...</span>)</pre>
    
    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>x</th>
      <td><p>A explore_df object from <code><a href='explore.html'>explore</a></code></p></td>
    </tr>
    <tr>
      <th>n_use</th>
      <td><p>Number of features to vary, default = 4. If the number of
features varied in <code><a href='explore.html'>explore</a></code> is greater than <code>n_use</code>,
additional features will be aggregated over by <code>aggregate_fun</code></p></td>
    </tr>
    <tr>
      <th>aggregate_fun</th>
      <td><p>Default = median. Varying features in x are mapped to
the x-axis, line color, and vertical- and horizontal facets. If more than
four features vary, this function is used to aggreagate across the
least-important varying features.</p></td>
    </tr>
    <tr>
      <th>reorder_categories</th>
      <td><p>If TRUE (default) varying categorical features are
arranged by their median predicted outcome. If FALSE, the incoming level
orders are retained, which is alphabetical by default, but you can set your
own level orders with <code>reorder</code></p></td>
    </tr>
    <tr>
      <th>x_var</th>
      <td><p>Feature to put on the x-axis (unquoted). If not provided, the
most important feature is used, with numerics prioritized if one varies</p></td>
    </tr>
    <tr>
      <th>color_var</th>
      <td><p>Feature to color lines (unquoted). If not provided, the most
important feature excluding <code>x_var</code> is used.</p></td>
    </tr>
    <tr>
      <th>jitter_y</th>
      <td><p>If TRUE (default) and a feature is mapped to color (i.e. if
there is more than one varying feature), the vertical location of the lines
will be jittered slightly (no more than 1<!-- % of the range of the outcome) to -->
avoid overlap.</p></td>
    </tr>
    <tr>
      <th>sig_fig</th>
      <td><p>Number of significant figures (digits) to use in labels of
numeric features. Default = 3; set to Inf to not truncate decimals.</p></td>
    </tr>
    <tr>
      <th>font_size</th>
      <td><p>Parent font size for the plot. Default = 11</p></td>
    </tr>
    <tr>
      <th>strip_font_size</th>
      <td><p>Relative font size for facet strip title font. Default
= 0.85</p></td>
    </tr>
    <tr>
      <th>line_width</th>
      <td><p>Width of lines. Default = 0.5</p></td>
    </tr>
    <tr>
      <th>line_alpha</th>
      <td><p>Opacity of lines. Default = 0.7</p></td>
    </tr>
    <tr>
      <th>rotate_x</th>
      <td><p>If FALSE (default), x axis tick labels are positioned
horizontally. If TRUE, they are rotated one quarter turn, which can be
helpful when a categorical feature with long labels is mapped to x.</p></td>
    </tr>
    <tr>
      <th>nrows</th>
      <td><p>Only used when the number of varying features is three. The
number of rows into which the facets will be arranged. Default = 1. NULL
lets the number be determined algorithmically</p></td>
    </tr>
    <tr>
      <th>title</th>
      <td><p>Plot title</p></td>
    </tr>
    <tr>
      <th>caption</th>
      <td><p>Plot caption. Defaults to model used to make counterfactual
predictions. Can be a string for custom caption or NULL for no caption.</p></td>
    </tr>
    <tr>
      <th>print</th>
      <td><p>Print the plot? Default is FALSE. Either way, the plot is
invisibly returned</p></td>
    </tr>
    <tr>
      <th>...</th>
      <td><p>Not used</p></td>
    </tr>
    </table>
    
    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>ggplot object, invisibly</p>
    

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='co'># First, we need a model</span>
<span class='fu'>set.seed</span>(<span class='fl'>4956</span>)
<span class='no'>m</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='machine_learn.html'>machine_learn</a></span>(<span class='no'>pima_diabetes</span>, <span class='no'>patient_id</span>, <span class='kw'>outcome</span> <span class='kw'>=</span> <span class='no'>pregnancies</span>,
                   <span class='kw'>models</span> <span class='kw'>=</span> <span class='st'>"rf"</span>, <span class='kw'>tune</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>)</div><div class='output co'>#&gt; <span class='message'>Training new data prep recipe...</span></div><div class='output co'>#&gt; <span class='message'>Variable(s) ignored in prep_data won't be used to tune models: patient_id</span></div><div class='output co'>#&gt; <span class='message'></span>
#&gt; <span class='message'>pregnancies looks numeric, so training regression algorithms.</span></div><div class='output co'>#&gt; <span class='message'></span>
#&gt; <span class='message'>After data processing, models are being trained on 14 features with 768 observations.</span>
#&gt; <span class='message'>Based on n_folds = 5 and hyperparameter settings, the following number of models will be trained: 5 rf's </span></div><div class='output co'>#&gt; <span class='message'>Training at fixed values: Random Forest</span></div><div class='output co'>#&gt; <span class='message'></span>
#&gt; <span class='message'>*** Models successfully trained. The model object contains the training data minus ignored ID columns. ***</span>
#&gt; <span class='message'>*** If there was PHI in training data, normal PHI protocols apply to the model object. ***</span></div><div class='input'><span class='co'># Then we can explore our model through counterfactual predictions</span>
<span class='no'>counterfactuals</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='explore.html'>explore</a></span>(<span class='no'>m</span>)

<span class='co'># By default only the two most important varying features are plotted. This</span>
<span class='co'># example shows how counterfactual predictions can provide insight into how a</span>
<span class='co'># model maps inputs (features) to the output (outcome). This plot shows that for</span>
<span class='co'># this dataset, age is the most important predictor of the number of pregnancies</span>
<span class='co'># a woman has had, and the predicted number of pregnancies rises basically</span>
<span class='co'># linearly from approximately 20 to 40 and then levels off.</span>
<span class='fu'>plot</span>(<span class='no'>counterfactuals</span>)</div><div class='output co'>#&gt; <span class='message'>With 4 varying features and n_use = 2, using median to aggregate predicted outcomes across diastolic_bp and weight_class. You could turn `n_use` up to see the impact of more features.</span></div><div class='img'><img src='plot.explore_df-1.png' alt='' width='576' height='288' /></div><div class='input'>
<span class='co'># To see the effects of more features in the model, increase the value of</span>
<span class='co'># `n_use`. You can also specify which of the varying features are mapped to the</span>
<span class='co'># x-axis and the color scale, and you can customize a variety of plot attributes</span>
<span class='fu'>plot</span>(<span class='no'>counterfactuals</span>, <span class='kw'>n_use</span> <span class='kw'>=</span> <span class='fl'>3</span>, <span class='kw'>x_var</span> <span class='kw'>=</span> <span class='no'>weight_class</span>, <span class='kw'>color_var</span> <span class='kw'>=</span> <span class='no'>age</span>,
    <span class='kw'>font_size</span> <span class='kw'>=</span> <span class='fl'>9</span>, <span class='kw'>strip_font_size</span> <span class='kw'>=</span> <span class='fl'>1</span>, <span class='kw'>line_width</span> <span class='kw'>=</span> <span class='fl'>2</span>, <span class='kw'>line_alpha</span> <span class='kw'>=</span> <span class='fl'>.5</span>,
    <span class='kw'>rotate_x</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>, <span class='kw'>nrows</span> <span class='kw'>=</span> <span class='fl'>1</span>)</div><div class='output co'>#&gt; <span class='message'>With 4 varying features and n_use = 3, using median to aggregate predicted outcomes across weight_class. You could turn `n_use` up to see the impact of more features.</span></div><div class='img'><img src='plot.explore_df-2.png' alt='' width='576' height='288' /></div><div class='input'>
<span class='co'># And you can further modify the plot like any other ggplot object</span>
<span class='no'>p</span> <span class='kw'>&lt;-</span> <span class='fu'>plot</span>(<span class='no'>counterfactuals</span>, <span class='kw'>n_use</span> <span class='kw'>=</span> <span class='fl'>1</span>, <span class='kw'>print</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>)</div><div class='output co'>#&gt; <span class='message'>With 4 varying features and n_use = 1, using median to aggregate predicted outcomes across skinfold, diastolic_bp, and weight_class. You could turn `n_use` up to see the impact of more features.</span></div><div class='input'><span class='no'>p</span> +
  <span class='fu'>ylab</span>(<span class='st'>"predicted number of pregnancies"</span>) +
  <span class='fu'>theme_classic</span>() +
  <span class='fu'>theme</span>(<span class='kw'>aspect.ratio</span> <span class='kw'>=</span> <span class='fl'>1</span>,
        <span class='kw'>panel.background</span> <span class='kw'>=</span> <span class='fu'>element_rect</span>(<span class='kw'>fill</span> <span class='kw'>=</span> <span class='st'>"slateblue"</span>),
        <span class='kw'>plot.caption</span> <span class='kw'>=</span> <span class='fu'>element_text</span>(<span class='kw'>face</span> <span class='kw'>=</span> <span class='st'>"italic"</span>))</div><div class='img'><img src='plot.explore_df-3.png' alt='' width='576' height='288' /></div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <h2>Contents</h2>
    <ul class="nav nav-pills nav-stacked">
      <li><a href="#arguments">Arguments</a></li>
      
      <li><a href="#value">Value</a></li>
      
      <li><a href="#examples">Examples</a></li>
    </ul>

  </div>
</div>

      <footer>
      <div class="copyright">
  <p>Developed by Levi Thatcher, Michael Levy, Mike Mastanduno, Taylor Larsen, Taylor Miller.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>

      </footer>
   </div>

  
<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.js"></script>
<script>
  docsearch({
    
    
    apiKey: 'ac39465bc37cbef616f5de1e646b6037',
    indexName: 'healthcareai',
    inputSelector: 'input#search-input.form-control',
    transformData: function(hits) {
      return hits.map(function (hit) {
        hit.url = updateHitURL(hit);
        return hit;
      });
    }
  });
</script>


  </body>
</html>

