<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Patient Impact Predictor — pip • healthcareai</title>

<!-- jquery -->
<script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script>
<!-- Bootstrap -->
<link href="https://maxcdn.bootstrapcdn.com/bootswatch/3.3.7/yeti/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">

<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

<!-- Font Awesome icons -->
<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js" integrity="sha384-cV+rhyOuRHc9Ub/91rihWcGmMmCXDeksTtCihMupQHSsi8GIIRDG0ThDc3HGQFJ3" crossorigin="anonymous"></script>

<!-- sticky kit -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>


<!-- docsearch -->
<script src="../docsearch.js"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.css" />
<link href="../docsearch.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script>


<meta property="og:title" content="Patient Impact Predictor — pip" />

<meta property="og:description" content="Identify opportunities to improve patient outcomes by exploring
  changes in predicted outcomes over changes to input variables. Note
  that causality cannot be established by this function. Omitted variable
  bias and other statistical phenomena may mean that the impacts predicted
  here are not realizable. Clinical guidance is essential in choosing
  new_values and acting on impact predictions. Extensive options are
  provided to control what impact predictions are surfaced, including
  variable_direction and prohibited_transitions." />

<meta property="og:image" content="https://docs.healthcare.ai/logo.png" />
<meta name="twitter:card" content="summary" />



<!-- mathjax -->
<script src='https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML'></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->


<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-85609357-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-85609357-1');
</script>

  </head>

  <body>
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">healthcareai</a>
        <span class="label label-default" data-toggle="tooltip" data-placement="bottom" title="Released package">2.2.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Vignettes
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/site_only/healthcareai.html">Getting Started</a>
    </li>
    <li>
      <a href="../articles/site_only/db_connections.html">Database Connections</a>
    </li>
    <li>
      <a href="../articles/site_only/deploy_model.html">Deploying a Model</a>
    </li>
    <li>
      <a href="../articles/site_only/best_levels.html">Variables with Many Categories</a>
    </li>
    <li>
      <a href="../articles/site_only/performance.html">Performance with Big Data</a>
    </li>
    <li>
      <a href="../articles/site_only/transitioning.html">Transition from Version 1</a>
    </li>
  </ul>
</li>
<li>
  <a href="../reference/index.html">Functions</a>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
      </ul>
      
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/HealthCatalyst/healthcareai-r">
    <span class="fa fa-github"></span>
     
  </a>
</li>
<li>
  <a href="https://healthcare-ai.slack.com/">
    <span class="fa fa-users"></span>
     
  </a>
</li>
      </ul>
      
      <form class="navbar-form navbar-right" role="search">
        <div class="form-group">
          <input type="search" class="form-control" name="search-input" id="search-input" placeholder="Search..." aria-label="Search for..." autocomplete="off">
        </div>
      </form>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      
      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Patient Impact Predictor</h1>
    
    <div class="hidden name"><code>pip.Rd</code></div>
    </div>

    <div class="ref-description">
    
    <p>Identify opportunities to improve patient outcomes by exploring
  changes in predicted outcomes over changes to input variables. <strong>Note
  that causality cannot be established by this function.</strong> Omitted variable
  bias and other statistical phenomena may mean that the impacts predicted
  here are not realizable. Clinical guidance is essential in choosing
  <code>new_values</code> and acting on impact predictions. Extensive options are
  provided to control what impact predictions are surfaced, including
  <code>variable_direction</code> and <code>prohibited_transitions</code>.</p>
    
    </div>

    <pre class="usage"><span class='fu'>pip</span>(<span class='no'>model</span>, <span class='no'>d</span>, <span class='no'>new_values</span>, <span class='kw'>n</span> <span class='kw'>=</span> <span class='fl'>3</span>, <span class='kw'>allow_same</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>,
  <span class='kw'>repeated_factors</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>, <span class='kw'>smaller_better</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>,
  <span class='kw'>variable_direction</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>prohibited_transitions</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='no'>id</span>)</pre>
    
    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>model</th>
      <td><p>A model_list object, as from <code><a href='machine_learn.html'>machine_learn</a></code> or
<code><a href='tune_models.html'>tune_models</a></code></p></td>
    </tr>
    <tr>
      <th>d</th>
      <td><p>A data frame on which <code>model</code> can make predictions</p></td>
    </tr>
    <tr>
      <th>new_values</th>
      <td><p>A list of alternative values for variables of interest. The
names of the list must be variables in <code>d</code> and the entries are the
alternative values to try.</p></td>
    </tr>
    <tr>
      <th>n</th>
      <td><p>Integer, default = 3. The maximum number of alternatives to return
for each patient. Note that the actual number returned may be less than
<code>n</code>, for example if <code>length(new_values) &lt; n</code> or if
<code>allow_same</code> is FALSE.</p></td>
    </tr>
    <tr>
      <th>allow_same</th>
      <td><p>Logical, default = FALSE. If TRUE, <code>pip</code> may return
rows with <code>modified_value = original_value</code> and <code>improvement =
0</code>. This happens when there are fewer than <code>n</code> modifications for a
patient that result in improvement. If <code>allow_same</code> is TRUE and
<code>length(new_values) &gt;= n</code> you are likely to get <code>n</code> results for
each patient; however, contraints from <code>variable_direction</code> or
<code>prohibited_transitions</code> could make recommendations for some variables
impossible, resulting in fewer than <code>n</code> recommendations.</p></td>
    </tr>
    <tr>
      <th>repeated_factors</th>
      <td><p>Logical, default = FALSE. Do you want multiple
modifications of the same variable for the same patient?</p></td>
    </tr>
    <tr>
      <th>smaller_better</th>
      <td><p>Logical, default = TRUE. Are lesser values of the
outcome variable in <code>model</code> preferable?</p></td>
    </tr>
    <tr>
      <th>variable_direction</th>
      <td><p>Named numeric vector or list with entries of -1 or
1. This specifies the direction numeric variables are permitted to move to
produce improvements. Names of the vector are names of variables in
<code>d</code>; entries are 1 to indicate only increases can yield improvements
or -1 to indicate only decreases can yield improvements. Numeric variables
not appearing in this list may increase or decrease to surface
improvements.</p></td>
    </tr>
    <tr>
      <th>prohibited_transitions</th>
      <td><p>A list of data frames that contain variable
modifications that won't be considered by <code>pip</code>. Names of the list are
names of variables in <code>d</code>, and data frames have two columns, "from"
and "to", indicating the original value and modified value, respectively,
of the prohibited transition. If column names are not "from" and "to", the
first column will be assumed to be the "from" column. This is intended for
categorical variables, but could be used for integers as well.</p></td>
    </tr>
    <tr>
      <th>id</th>
      <td><p>Optional. A unquoted variable name in <code>d</code> representing an
identifier column; it will be included in the returned data frame. If not
provided, an ID column from <code>model</code>'s data prep will be used if
available.</p></td>
    </tr>
    </table>
    
    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>A tibble with any id columns and "variable": the name of the variable
  being altered, "original_value": the patient's observed value of
  "variable", "modified_value": the altered value of "variable",
  "original_prediction": the patient's original prediction,
  "modified_prediction": the patient's prediction given the that "variable"
  changes to "modified_value", "improvement": the difference between the
  original and modified prediction with positive values reflecting
  improvement based on the value of <code>smaller_better</code>, and "impact_rank":
  the rank of the modification for that patient.</p>
    

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='co'># First, we need a model to make recommendations</span>
<span class='fu'>set.seed</span>(<span class='fl'>52760</span>)
<span class='no'>m</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='machine_learn.html'>machine_learn</a></span>(<span class='no'>pima_diabetes</span>, <span class='no'>patient_id</span>, <span class='kw'>outcome</span> <span class='kw'>=</span> <span class='no'>diabetes</span>,
                   <span class='kw'>tune</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>, <span class='kw'>models</span> <span class='kw'>=</span> <span class='st'>"xgb"</span>)</div><div class='output co'>#&gt; <span class='message'>Training new data prep recipe...</span></div><div class='output co'>#&gt; <span class='message'>Variable(s) ignored in prep_data won't be used to tune models: patient_id</span></div><div class='output co'>#&gt; <span class='message'></span>
#&gt; <span class='message'>diabetes looks categorical, so training classification algorithms.</span></div><div class='output co'>#&gt; <span class='message'></span>
#&gt; <span class='message'>After data processing, models are being trained on 12 features with 768 observations.</span>
#&gt; <span class='message'>Based on n_folds = 5 and hyperparameter settings, the following number of models will be trained: 5 xgb's </span></div><div class='output co'>#&gt; <span class='message'>Training at fixed values: eXtreme Gradient Boosting</span></div><div class='output co'>#&gt; <span class='message'></span>
#&gt; <span class='message'>*** Models successfully trained. The model object contains the training data minus ignored ID columns. ***</span>
#&gt; <span class='message'>*** If there was PHI in training data, normal PHI protocols apply to the model object. ***</span></div><div class='input'><span class='co'># Let's look at changes in predicted outcomes for three patients changing their</span>
<span class='co'># weight class, blood glucose, and blood pressure</span>
<span class='no'>modifications</span> <span class='kw'>&lt;-</span> <span class='fu'>list</span>(<span class='kw'>weight_class</span> <span class='kw'>=</span> <span class='fu'>c</span>(<span class='st'>"underweight"</span>, <span class='st'>"normal"</span>, <span class='st'>"overweight"</span>),
                      <span class='kw'>plasma_glucose</span> <span class='kw'>=</span> <span class='fu'>c</span>(<span class='fl'>75</span>, <span class='fl'>100</span>),
                      <span class='kw'>diastolic_bp</span> <span class='kw'>=</span> <span class='fl'>70</span>)
<span class='fu'>pip</span>(<span class='kw'>model</span> <span class='kw'>=</span> <span class='no'>m</span>, <span class='kw'>d</span> <span class='kw'>=</span> <span class='no'>pima_diabetes</span>[<span class='fl'>1</span>:<span class='fl'>3</span>, ], <span class='kw'>new_values</span> <span class='kw'>=</span> <span class='no'>modifications</span>)</div><div class='output co'>#&gt; # A tibble: 6 x 8
#&gt;   patient_id variable original_value modified_value original_predic…
#&gt;        &lt;int&gt; &lt;chr&gt;    &lt;chr&gt;          &lt;chr&gt;                     &lt;dbl&gt;
#&gt; 1          1 plasma_… 148            75                       0.926 
#&gt; 2          1 weight_… obese          underweight              0.926 
#&gt; 3          1 diastol… 72             70                       0.926 
#&gt; 4          2 weight_… overweight     normal                   0.0552
#&gt; 5          2 plasma_… 85             75                       0.0552
#&gt; 6          3 plasma_… 183            75                       0.810 
#&gt; # ... with 3 more variables: modified_prediction &lt;dbl&gt;, improvement &lt;dbl&gt;,
#&gt; #   impact_rank &lt;int&gt;</div><div class='input'>
<span class='co'># In the above example, only the first patient has a positive predicted impact</span>
<span class='co'># from changing their diastolic_bp, so for the other patients fewer than the</span>
<span class='co'># default n=3 predictions are provided. We can get n=3 predictions for each</span>
<span class='co'># patient by specifying allow_same, which will recommend the other two patients</span>
<span class='co'># maintain their current diastolic_bp.</span>
<span class='fu'>pip</span>(<span class='kw'>model</span> <span class='kw'>=</span> <span class='no'>m</span>, <span class='kw'>d</span> <span class='kw'>=</span> <span class='no'>pima_diabetes</span>[<span class='fl'>1</span>:<span class='fl'>3</span>, ], <span class='kw'>new_values</span> <span class='kw'>=</span> <span class='no'>modifications</span>, <span class='kw'>allow_same</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>)</div><div class='output co'>#&gt; # A tibble: 9 x 8
#&gt;   patient_id variable original_value modified_value original_predic…
#&gt;        &lt;int&gt; &lt;chr&gt;    &lt;chr&gt;          &lt;chr&gt;                     &lt;dbl&gt;
#&gt; 1          1 plasma_… 148            75                       0.926 
#&gt; 2          1 weight_… obese          underweight              0.926 
#&gt; 3          1 diastol… 72             70                       0.926 
#&gt; 4          2 plasma_… 85             75                       0.0552
#&gt; 5          2 weight_… overweight     overweight               0.0552
#&gt; 6          2 diastol… 66             66                       0.0552
#&gt; 7          3 plasma_… 183            75                       0.810 
#&gt; 8          3 weight_… normal         normal                   0.810 
#&gt; 9          3 diastol… 64             64                       0.810 
#&gt; # ... with 3 more variables: modified_prediction &lt;dbl&gt;, improvement &lt;dbl&gt;,
#&gt; #   impact_rank &lt;int&gt;</div><div class='input'>
<span class='co'># Sometimes clinical knowledge trumps machine learning. In particular, machine</span>
<span class='co'># learning models don't establish causality, they only leverage correlation.</span>
<span class='co'># Patient impact predictor suggests causality, so clinicians should always be</span>
<span class='co'># consulted to ensure that the causal impacts are medically sound.</span>
<span class='co'>#</span>
<span class='co'># If there is clinical knowledge to suggest what impact a variable should have,</span>
<span class='co'># that knowledge can be provided to pip. The way it is provided depends on</span>
<span class='co'># whether the variable is categorical (prohibited_transitions) or numeric</span>
<span class='co'># (variable_direction).</span>

<span class='co'>### Constraining categorical variables ###</span>
<span class='co'># Suppose a clinician says that recommending a patient change their weight class</span>
<span class='co'># to underweight from any value except normal is a bad idea. We can disallow</span>
<span class='co'># those suggestions using prohibited_transitions. Note the change in patient</span>
<span class='co'># 1's second recommendation goes from underweight to normal.</span>
<span class='no'>prohibit</span> <span class='kw'>&lt;-</span> <span class='fu'>data.frame</span>(<span class='kw'>from</span> <span class='kw'>=</span> <span class='fu'>setdiff</span>(<span class='fu'>unique</span>(<span class='no'>pima_diabetes</span>$<span class='no'>weight_class</span>), <span class='st'>"normal"</span>),
                       <span class='kw'>to</span> <span class='kw'>=</span> <span class='st'>"underweight"</span>)
<span class='fu'>pip</span>(<span class='kw'>model</span> <span class='kw'>=</span> <span class='no'>m</span>, <span class='kw'>d</span> <span class='kw'>=</span> <span class='no'>pima_diabetes</span>[<span class='fl'>1</span>:<span class='fl'>3</span>, ], <span class='kw'>new_values</span> <span class='kw'>=</span> <span class='no'>modifications</span>,
    <span class='kw'>prohibited_transitions</span> <span class='kw'>=</span> <span class='fu'>list</span>(<span class='kw'>weight_class</span> <span class='kw'>=</span> <span class='no'>prohibit</span>))</div><div class='output co'>#&gt; # A tibble: 6 x 8
#&gt;   patient_id variable original_value modified_value original_predic…
#&gt;        &lt;int&gt; &lt;chr&gt;    &lt;chr&gt;          &lt;chr&gt;                     &lt;dbl&gt;
#&gt; 1          1 plasma_… 148            75                       0.926 
#&gt; 2          1 weight_… obese          normal                   0.926 
#&gt; 3          1 diastol… 72             70                       0.926 
#&gt; 4          2 weight_… overweight     normal                   0.0552
#&gt; 5          2 plasma_… 85             75                       0.0552
#&gt; 6          3 plasma_… 183            75                       0.810 
#&gt; # ... with 3 more variables: modified_prediction &lt;dbl&gt;, improvement &lt;dbl&gt;,
#&gt; #   impact_rank &lt;int&gt;</div><div class='input'>
<span class='co'>### Constraining numeric variables ###</span>
<span class='co'># Suppose a clinician says that increasing diastolic_bp should never be</span>
<span class='co'># recommended to improve diabetes outcomes, and likewise for reducing</span>
<span class='co'># plasma_glucose (which is clinically silly, but provides an illustration). The</span>
<span class='co'># following code ensures that diastolic_bp is only recommended to decrease and</span>
<span class='co'># plasma_glucose is only recommended to increase. Note that the plasma_glucose</span>
<span class='co'># recommendations disappear, because no patient would see their outcomes</span>
<span class='co'># improve by increasing their plasma_glucose.</span>
<span class='no'>directional_changes</span> <span class='kw'>&lt;-</span> <span class='fu'>c</span>(<span class='kw'>diastolic_bp</span> <span class='kw'>=</span> -<span class='fl'>1</span>, <span class='kw'>plasma_glucose</span> <span class='kw'>=</span> <span class='fl'>1</span>)
<span class='fu'>pip</span>(<span class='kw'>model</span> <span class='kw'>=</span> <span class='no'>m</span>, <span class='kw'>d</span> <span class='kw'>=</span> <span class='no'>pima_diabetes</span>[<span class='fl'>1</span>:<span class='fl'>3</span>, ], <span class='kw'>new_values</span> <span class='kw'>=</span> <span class='no'>modifications</span>,
    <span class='kw'>variable_direction</span> <span class='kw'>=</span> <span class='no'>directional_changes</span>)</div><div class='output co'>#&gt; # A tibble: 3 x 8
#&gt;   patient_id variable original_value modified_value original_predic…
#&gt;        &lt;int&gt; &lt;chr&gt;    &lt;chr&gt;          &lt;chr&gt;                     &lt;dbl&gt;
#&gt; 1          1 weight_… obese          underweight              0.926 
#&gt; 2          1 diastol… 72             70                       0.926 
#&gt; 3          2 weight_… overweight     normal                   0.0552
#&gt; # ... with 3 more variables: modified_prediction &lt;dbl&gt;, improvement &lt;dbl&gt;,
#&gt; #   impact_rank &lt;int&gt;</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <h2>Contents</h2>
    <ul class="nav nav-pills nav-stacked">
      <li><a href="#arguments">Arguments</a></li>
      
      <li><a href="#value">Value</a></li>
      
      <li><a href="#examples">Examples</a></li>
    </ul>

  </div>
</div>

      <footer>
      <div class="copyright">
  <p>Developed by Levi Thatcher, Michael Levy, Mike Mastanduno, Taylor Larsen, Taylor Miller.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>

      </footer>
   </div>

  
<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.js"></script>
<script>
  docsearch({
    
    
    apiKey: 'ac39465bc37cbef616f5de1e646b6037',
    indexName: 'healthcareai',
    inputSelector: 'input#search-input.form-control',
    transformData: function(hits) {
      return hits.map(function (hit) {
        hit.url = updateHitURL(hit);
        return hit;
      });
    }
  });
</script>


  </body>
</html>

