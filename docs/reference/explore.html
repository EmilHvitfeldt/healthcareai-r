<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Explore a model's "reasoning" via counterfactual predictions — explore • healthcareai</title>

<!-- jquery -->
<script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script>
<!-- Bootstrap -->
<link href="https://maxcdn.bootstrapcdn.com/bootswatch/3.3.7/yeti/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">

<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

<!-- Font Awesome icons -->
<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js" integrity="sha384-cV+rhyOuRHc9Ub/91rihWcGmMmCXDeksTtCihMupQHSsi8GIIRDG0ThDc3HGQFJ3" crossorigin="anonymous"></script>

<!-- sticky kit -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>


<!-- docsearch -->
<script src="../docsearch.js"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.css" />
<link href="../docsearch.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script>


<meta property="og:title" content="Explore a model's "reasoning" via counterfactual predictions — explore" />

<meta property="og:description" content="Make predictions for observations that vary over features of
  interest. There are two major use cases for this function. One is to
  understand how the model responds to features, not just individually but
  over combinations of features (i.e. interaction effects). The other is to
  explore how an individual prediction would vary if feature values were
  different. Note, however, that this function does not establish
  causality and the latter use case should be deployed judiciously." />

<meta property="og:image" content="https://docs.healthcare.ai/logo.png" />
<meta name="twitter:card" content="summary" />



<!-- mathjax -->
<script src='https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML'></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->


<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-85609357-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-85609357-1');
</script>

  </head>

  <body>
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">healthcareai</a>
        <span class="label label-default" data-toggle="tooltip" data-placement="bottom" title="Released package">2.2.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Vignettes
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/site_only/healthcareai.html">Getting Started</a>
    </li>
    <li>
      <a href="../articles/site_only/db_connections.html">Database Connections</a>
    </li>
    <li>
      <a href="../articles/site_only/deploy_model.html">Deploying a Model</a>
    </li>
    <li>
      <a href="../articles/site_only/best_levels.html">Variables with Many Categories</a>
    </li>
    <li>
      <a href="../articles/site_only/performance.html">Performance with Big Data</a>
    </li>
    <li>
      <a href="../articles/site_only/transitioning.html">Transition from Version 1</a>
    </li>
  </ul>
</li>
<li>
  <a href="../reference/index.html">Functions</a>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
      </ul>
      
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/HealthCatalyst/healthcareai-r">
    <span class="fa fa-github"></span>
     
  </a>
</li>
<li>
  <a href="https://healthcare-ai.slack.com/">
    <span class="fa fa-users"></span>
     
  </a>
</li>
      </ul>
      
      <form class="navbar-form navbar-right" role="search">
        <div class="form-group">
          <input type="search" class="form-control" name="search-input" id="search-input" placeholder="Search..." aria-label="Search for..." autocomplete="off">
        </div>
      </form>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      
      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Explore a model's "reasoning" via counterfactual predictions</h1>
    
    <div class="hidden name"><code>explore.Rd</code></div>
    </div>

    <div class="ref-description">
    
    <p>Make predictions for observations that vary over features of
  interest. There are two major use cases for this function. One is to
  understand how the model responds to features, not just individually but
  over combinations of features (i.e. interaction effects). The other is to
  explore how an individual prediction would vary if feature values were
  different. <strong>Note, however, that this function does not establish
  causality and the latter use case should be deployed judiciously.</strong></p>
    
    </div>

    <pre class="usage"><span class='fu'>explore</span>(<span class='no'>models</span>, <span class='kw'>vary</span> <span class='kw'>=</span> <span class='fl'>4</span>, <span class='kw'>hold</span> <span class='kw'>=</span> <span class='fu'>list</span>(<span class='kw'>numerics</span> <span class='kw'>=</span> <span class='no'>median</span>, <span class='kw'>characters</span> <span class='kw'>=</span> <span class='no'>Mode</span>),
  <span class='kw'>numerics</span> <span class='kw'>=</span> <span class='fu'>c</span>(<span class='fl'>0.05</span>, <span class='fl'>0.25</span>, <span class='fl'>0.5</span>, <span class='fl'>0.75</span>, <span class='fl'>0.95</span>), <span class='kw'>characters</span> <span class='kw'>=</span> <span class='fl'>5</span>)</pre>
    
    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>models</th>
      <td><p>A model_list object. The data the model was trained on must
have been prepared, either by training with <code><a href='machine_learn.html'>machine_learn</a></code> or
by preparing with <code><a href='prep_data.html'>prep_data</a></code> before model training.</p></td>
    </tr>
    <tr>
      <th>vary</th>
      <td><p>Which (or how many) features to vary? Default is 4; if
<code>vary</code> is a single integer (n), the n-most-important features are
varied (see Details for how importance is determined). If <code>vary</code> is a
vector of integers, those rankings of features are used (e.g. <code>vary =
2:4</code> varies the 2nd, 3rd, and 4th most-important features). Alternatively,
you can specify which features to vary by passing a vector of feature
names. For the finest level of control, you can choose the alternative
values to use by passing a list with names being features names and entries
being values to use; in this case <code>numerics</code> and <code>characters</code> are
ignored.</p></td>
    </tr>
    <tr>
      <th>hold</th>
      <td><p>How to choose the values of features not being varied? To make
counterfactual predictions for a particular patient, this can be a row of
the training data frame (or a one-row data frame containing values for all
of the non-varying features). Alternatively, this can be functions to
determine the values of non-varying features, in which case it must be a
length-2 list with names "numerics" and "characters", each being a function
to determine the values of non-varying features of that data type. The
default is <code>list(numerics = median, characters = Mode)</code>; numerics is
applied to the column from the training data, characters is applied to a
frequency table of the column from the training data.</p></td>
    </tr>
    <tr>
      <th>numerics</th>
      <td><p>How to determine values of numeric features being varied? By
default, the 5th, 25th, 50th (median), 75th, and 95th percentile values
from the training dataset will be used. To specify evenly spaced quantiles,
starting with the 5th and ending with the 95th, pass an integer to this
argument. To specify which quantiles to use, pass a numeric vector in [0,
1] to this argument, e.g. <code>c(0, .5, 1)</code> for the minimum, median, and
maximum values from the training dataset.</p></td>
    </tr>
    <tr>
      <th>characters</th>
      <td><p>Integer. For categorical variables being varied, how many
values to use? Values are used from most- to least-common; default is 5.</p></td>
    </tr>
    </table>
    
    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>A tibble with values of features used to make predictions and
  predictions. Has class <code>explore_df</code> and attribute <code>vi</code> giving
  information about the varying features.</p>
    
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>If <code>vary</code> is an integer, the most important features are
  determined by <code><a href='get_variable_importance.html'>get_variable_importance</a></code>, unless glm is the only
  model present, in which case <code><a href='interpret.html'>interpret</a></code> is used with a
  warning. When selecting the most important features to vary, for
  categorical features the sum of feature importance of all the levels as
  dummies is used.</p>
    
    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <div class='dont-index'><p><code><a href='plot.explore_df.html'>plot.explore_df</a></code></p></div>
    

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='co'># First, we need a model on which to make counterfactual predictions</span>
<span class='fu'>set.seed</span>(<span class='fl'>5176</span>)
<span class='no'>m</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='machine_learn.html'>machine_learn</a></span>(<span class='no'>pima_diabetes</span>, <span class='no'>patient_id</span>, <span class='kw'>outcome</span> <span class='kw'>=</span> <span class='no'>diabetes</span>,
                   <span class='kw'>tune</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>, <span class='kw'>models</span> <span class='kw'>=</span> <span class='st'>"xgb"</span>)</div><div class='output co'>#&gt; <span class='message'>Training new data prep recipe...</span></div><div class='output co'>#&gt; <span class='message'>Variable(s) ignored in prep_data won't be used to tune models: patient_id</span></div><div class='output co'>#&gt; <span class='message'></span>
#&gt; <span class='message'>diabetes looks categorical, so training classification algorithms.</span></div><div class='output co'>#&gt; <span class='message'></span>
#&gt; <span class='message'>After data processing, models are being trained on 12 features with 768 observations.</span>
#&gt; <span class='message'>Based on n_folds = 5 and hyperparameter settings, the following number of models will be trained: 5 xgb's </span></div><div class='output co'>#&gt; <span class='message'>Training at fixed values: eXtreme Gradient Boosting</span></div><div class='output co'>#&gt; <span class='message'></span>
#&gt; <span class='message'>*** Models successfully trained. The model object contains the training data minus ignored ID columns. ***</span>
#&gt; <span class='message'>*** If there was PHI in training data, normal PHI protocols apply to the model object. ***</span></div><div class='input'>
<span class='co'># By default, the four most important features are varied, with numeric</span>
<span class='co'># features taking their 5, 25, 50, 75, and 95 percentile values, and</span>
<span class='co'># categoricals taking their five most common values. Others features are</span>
<span class='co'># held at their median and modal values for numeric and categorical features,</span>
<span class='co'># respectively. This can provide insight into how the model responds to</span>
<span class='co'># different features</span>
<span class='fu'>explore</span>(<span class='no'>m</span>)</div><div class='output co'>#&gt; # A tibble: 625 x 9
#&gt;    predicted_diabe… plasma_glucose pedigree   age diastolic_bp pregnancies
#&gt;  *            &lt;dbl&gt;          &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt;        &lt;dbl&gt;       &lt;dbl&gt;
#&gt;  1           0.0253             80    0.140    21           52           3
#&gt;  2           0.0504             99    0.140    21           52           3
#&gt;  3           0.177             117    0.140    21           52           3
#&gt;  4           0.693             141    0.140    21           52           3
#&gt;  5           0.894             181    0.140    21           52           3
#&gt;  6           0.0230             80    0.244    21           52           3
#&gt;  7           0.0541             99    0.244    21           52           3
#&gt;  8           0.178             117    0.244    21           52           3
#&gt;  9           0.669             141    0.244    21           52           3
#&gt; 10           0.898             181    0.244    21           52           3
#&gt; # ... with 615 more rows, and 3 more variables: skinfold &lt;dbl&gt;, insulin &lt;dbl&gt;,
#&gt; #   weight_class &lt;chr&gt;</div><div class='input'>
<span class='co'># It is easy to plot counterfactual predictions. By default, only the two most</span>
<span class='co'># important features are plotted over; see `?plot.explore_df` for</span>
<span class='co'># customization options</span>
<span class='fu'>explore</span>(<span class='no'>m</span>) <span class='kw'>%&gt;%</span>
  <span class='fu'>plot</span>()</div><div class='output co'>#&gt; <span class='message'>With 4 varying features and n_use = 2, using median to aggregate predicted outcomes across age and diastolic_bp. You could turn `n_use` up to see the impact of more features.</span></div><div class='img'><img src='explore-1.png' alt='' width='576' height='288' /></div><div class='input'>
<span class='co'># You can specify which features vary and what values they take in a variety of</span>
<span class='co'># ways. For example, you could vary only "weight_class" and "plasma_glucose"</span>
<span class='fu'>explore</span>(<span class='no'>m</span>, <span class='kw'>vary</span> <span class='kw'>=</span> <span class='fu'>c</span>(<span class='st'>"weight_class"</span>, <span class='st'>"plasma_glucose"</span>))</div><div class='output co'>#&gt; # A tibble: 25 x 9
#&gt;    predicted_diabe… weight_class plasma_glucose pregnancies diastolic_bp
#&gt;  *            &lt;dbl&gt; &lt;chr&gt;                 &lt;dbl&gt;       &lt;dbl&gt;        &lt;dbl&gt;
#&gt;  1          0.00944 obese                    80           3           72
#&gt;  2          0.00906 overweight               80           3           72
#&gt;  3          0.00216 normal                   80           3           72
#&gt;  4          0.00906 morbidly ob…             80           3           72
#&gt;  5          0.00906 &lt;NA&gt;                     80           3           72
#&gt;  6          0.100   obese                    99           3           72
#&gt;  7          0.0766  overweight               99           3           72
#&gt;  8          0.0146  normal                   99           3           72
#&gt;  9          0.0766  morbidly ob…             99           3           72
#&gt; 10          0.0766  &lt;NA&gt;                     99           3           72
#&gt; # ... with 15 more rows, and 4 more variables: skinfold &lt;dbl&gt;, insulin &lt;dbl&gt;,
#&gt; #   pedigree &lt;dbl&gt;, age &lt;dbl&gt;</div><div class='input'>
<span class='co'># You can also control what values non-varying features take.</span>
<span class='co'># For example, if you want to simulate alternative scenarios for patient 321</span>
<span class='no'>patient321</span> <span class='kw'>&lt;-</span> <span class='kw pkg'>dplyr</span><span class='kw ns'>::</span><span class='fu'><a href='http://dplyr.tidyverse.org/reference/filter.html'>filter</a></span>(<span class='no'>pima_diabetes</span>, <span class='no'>patient_id</span> <span class='kw'>==</span> <span class='fl'>321</span>)
<span class='no'>patient321</span></div><div class='output co'>#&gt; # A tibble: 1 x 10
#&gt;   patient_id pregnancies plasma_glucose diastolic_bp skinfold insulin
#&gt;        &lt;int&gt;       &lt;int&gt;          &lt;int&gt;        &lt;int&gt;    &lt;int&gt;   &lt;int&gt;
#&gt; 1        321           4            129           60       12     231
#&gt; # ... with 4 more variables: weight_class &lt;chr&gt;, pedigree &lt;dbl&gt;, age &lt;int&gt;,
#&gt; #   diabetes &lt;chr&gt;</div><div class='input'><span class='fu'>explore</span>(<span class='no'>m</span>, <span class='kw'>hold</span> <span class='kw'>=</span> <span class='no'>patient321</span>)</div><div class='output co'>#&gt; # A tibble: 625 x 9
#&gt;    predicted_diabe… plasma_glucose pedigree   age diastolic_bp pregnancies
#&gt;  *            &lt;dbl&gt;          &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt;        &lt;dbl&gt;       &lt;int&gt;
#&gt;  1          0.00463             80    0.140    21           52           4
#&gt;  2          0.00694             99    0.140    21           52           4
#&gt;  3          0.00557            117    0.140    21           52           4
#&gt;  4          0.0140             141    0.140    21           52           4
#&gt;  5          0.245              181    0.140    21           52           4
#&gt;  6          0.00690             80    0.244    21           52           4
#&gt;  7          0.0123              99    0.244    21           52           4
#&gt;  8          0.00922            117    0.244    21           52           4
#&gt;  9          0.0182             141    0.244    21           52           4
#&gt; 10          0.225              181    0.244    21           52           4
#&gt; # ... with 615 more rows, and 3 more variables: skinfold &lt;int&gt;, insulin &lt;int&gt;,
#&gt; #   weight_class &lt;chr&gt;</div><div class='input'>
<span class='co'># Here is an example in which both the varying and non-varying feature values</span>
<span class='co'># are explicitly specified.</span>
<span class='fu'>explore</span>(<span class='no'>m</span>,
        <span class='kw'>vary</span> <span class='kw'>=</span> <span class='fu'>list</span>(<span class='kw'>weight_class</span> <span class='kw'>=</span> <span class='fu'>c</span>(<span class='st'>"normal"</span>, <span class='st'>"overweight"</span>, <span class='st'>"obese"</span>),
                    <span class='kw'>plasma_glucose</span> <span class='kw'>=</span> <span class='fu'>seq</span>(<span class='fl'>60</span>, <span class='fl'>200</span>, <span class='fl'>10</span>)),
        <span class='kw'>hold</span> <span class='kw'>=</span> <span class='fu'>list</span>(<span class='kw'>pregnancies</span> <span class='kw'>=</span> <span class='fl'>2</span>,
                    <span class='kw'>pedigree</span> <span class='kw'>=</span> <span class='fl'>.5</span>,
                    <span class='kw'>age</span> <span class='kw'>=</span> <span class='fl'>25</span>,
                    <span class='kw'>insulin</span> <span class='kw'>=</span> <span class='fl'>NA</span>,
                    <span class='kw'>skinfold</span> <span class='kw'>=</span> <span class='fl'>NA</span>,
                    <span class='kw'>diastolic_bp</span> <span class='kw'>=</span> <span class='fl'>85</span>)) <span class='kw'>%&gt;%</span>
  <span class='fu'>plot</span>()</div><div class='img'><img src='explore-2.png' alt='' width='576' height='288' /></div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <h2>Contents</h2>
    <ul class="nav nav-pills nav-stacked">
      <li><a href="#arguments">Arguments</a></li>
      
      <li><a href="#value">Value</a></li>

      <li><a href="#details">Details</a></li>

      <li><a href="#see-also">See also</a></li>
      
      <li><a href="#examples">Examples</a></li>
    </ul>

  </div>
</div>

      <footer>
      <div class="copyright">
  <p>Developed by Levi Thatcher, Michael Levy, Mike Mastanduno, Taylor Larsen, Taylor Miller.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>

      </footer>
   </div>

  
<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.js"></script>
<script>
  docsearch({
    
    
    apiKey: 'ac39465bc37cbef616f5de1e646b6037',
    indexName: 'healthcareai',
    inputSelector: 'input#search-input.form-control',
    transformData: function(hits) {
      return hits.map(function (hit) {
        hit.url = updateHitURL(hit);
        return hit;
      });
    }
  });
</script>


  </body>
</html>

